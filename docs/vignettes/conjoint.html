<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.43">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Marginal Effects Zoo – Conjoint experiments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../vignettes/elasticity.html" rel="next">
<link href="../vignettes/conformal.html" rel="prev">
<link href="../images/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/marginaleffects_icon.png" alt="marginaleffects logo" class="navbar-logo"></a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Marginal Effects Zoo</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link active" href="../vignettes/get_started.html" aria-current="page"> 
<span class="menu-text">Get started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../files/marginaleffects_arel-bundock_greifer_heiss_jss5115.pdf"> 
<span class="menu-text">Article</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../vignettes/help.html"> 
<span class="menu-text">Help</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/vincentarelbundock/marginaleffects"> <i class="bi bi-github" role="img" aria-label="marginaleffects GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/vincentab"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../vignettes/brms.html">Case studies</a></li><li class="breadcrumb-item"><a href="../vignettes/conjoint.html">Conjoint experiments</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/get_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Get started</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Predictions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/comparisons.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Comparisons</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/slopes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Slopes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/hypothesis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hypothesis Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Plots</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Case studies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/brms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/bootstrap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bootstrap &amp; Simulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/categorical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Categorical outcomes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/conformal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conformal prediction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/conjoint.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Conjoint experiments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/elasticity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Elasticity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/equivalence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Equivalence Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Experiments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/gam.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GAM</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/gcomputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">G-Computation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/heterogeneity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Heterogeneity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/interactions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interactions, polynomials, and splines</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/ipw.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Inverse Probability Weighting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/logit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Logit</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/lme4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mixed Effects</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/machine_learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Machine Learning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/marginalmeans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Marginal Means</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Matching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/mrp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MrP</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/multiple_imputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Missing Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/svalues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">S Values</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Miscellaneous</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Help</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/faq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FAQ</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/meme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Meme gallery</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/alternative_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Alternative Software</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/extensions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Extensions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/links.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Links</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/performance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/numpyro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NumPyro</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/supported_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Supported Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/uncertainty.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Standard Errors</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Functions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>predictions</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/comparisons.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>comparisons</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/slopes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>slopes</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/plot_predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>plot_predictions</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/plot_comparisons.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>plot_comparisons</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/plot_slopes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>plot_slopes</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/hypotheses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>hypotheses</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/inferences.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>inferences</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/posterior_draws.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>posterior_draws</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/datagrid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>datagrid</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/print.marginaleffects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>print.marginaleffects</code></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../NEWS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">News</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LICENSE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">License</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../CITATION.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Citation</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a></li>
  <li>
<a href="#marginal-means" id="toc-marginal-means" class="nav-link" data-scroll-target="#marginal-means">Marginal means</a>
  <ul class="collapse">
<li><a href="#hypothesis-tests" id="toc-hypothesis-tests" class="nav-link" data-scroll-target="#hypothesis-tests">Hypothesis tests</a></li>
  <li><a href="#subgroups" id="toc-subgroups" class="nav-link" data-scroll-target="#subgroups">Subgroups</a></li>
  </ul>
</li>
  <li>
<a href="#average-marginal-component-effects" id="toc-average-marginal-component-effects" class="nav-link" data-scroll-target="#average-marginal-component-effects">Average Marginal Component Effects</a>
  <ul class="collapse">
<li><a href="#empirical-vs.-balanced-grid" id="toc-empirical-vs.-balanced-grid" class="nav-link" data-scroll-target="#empirical-vs.-balanced-grid">Empirical vs.&nbsp;balanced grid</a></li>
  </ul>
</li>
  <li>
<a href="#average-feature-choice-probability" id="toc-average-feature-choice-probability" class="nav-link" data-scroll-target="#average-feature-choice-probability">Average Feature Choice Probability</a>
  <ul class="collapse">
<li><a href="#hypothesis-tests-1" id="toc-hypothesis-tests-1" class="nav-link" data-scroll-target="#hypothesis-tests-1">Hypothesis tests</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../vignettes/brms.html">Case studies</a></li><li class="breadcrumb-item"><a href="../vignettes/conjoint.html">Conjoint experiments</a></li></ol></nav><div class="quarto-title">
<h1 class="title">Conjoint experiments</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><div class="cell">
<style type="text/css">
.table {
  font-size: .8em;
}
</style>
</div>
<p>A forced-choice conjoint experiment is a research methodology used in many fields such as marketing and political science to understand how people make decisions between “profiles” characterized by multiple “attributes.” In this type of experiment, participants are presented with a series of choices between different products, services, or scenarios. Each option is described by a set of attributes (e.g., price, quality, brand, features), and the levels of these attributes are varied randomly across the options presented.</p>
<p>Consider an experiment where researchers ask survey respondents “to act as immigration officials and to decide which of a pair of immigrants they would choose for admission” <span class="citation" data-cites="HaiHopYam2014">(<a href="#ref-HaiHopYam2014" role="doc-biblioref">Hainmueller, Hopkins, and Yamamoto 2014</a>)</span>. They display a table in which each column represents a distinct immigrant “profile” with randomized attributes. For example:</p>
<div class="cell">
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_84s1i3ud4gpxkzmtc8j3(i, j, css_id) {
        var table = document.getElementById("tinytable_84s1i3ud4gpxkzmtc8j3");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_84s1i3ud4gpxkzmtc8j3');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_84s1i3ud4gpxkzmtc8j3(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_84s1i3ud4gpxkzmtc8j3");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_84s1i3ud4gpxkzmtc8j3(0, 0, 'tinytable_css_iduj5qfhluqb3qyp36e0l0') })
window.addEventListener('load', function () { styleCell_84s1i3ud4gpxkzmtc8j3(0, 1, 'tinytable_css_iduj5qfhluqb3qyp36e0l0') })
window.addEventListener('load', function () { styleCell_84s1i3ud4gpxkzmtc8j3(0, 2, 'tinytable_css_iduj5qfhluqb3qyp36e0l0') })
    </script><style>
    .table td.tinytable_css_iduj5qfhluqb3qyp36e0l0, .table th.tinytable_css_iduj5qfhluqb3qyp36e0l0 {  border-bottom: solid 0.1em #d3d8dc; }
    </style>
<div class="container">
      <table class="table table-borderless" id="tinytable_84s1i3ud4gpxkzmtc8j3" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<caption><p>A single forced-choice task in a conjoint experiment. The survey
respondent must choose one of the two profiles before seeing a second
task.</p></caption>
        <thead><tr>
<th scope="col">Attributes</th>
                <th scope="col">Profile 1</th>
                <th scope="col">Profile 2</th>
              </tr></thead>
<tbody>
<tr>
<td>Language Skills</td>
                  <td>Fluent in English  </td>
                  <td>Broken English</td>
                </tr>
<tr>
<td>Job            </td>
                  <td>Construction worker</td>
                  <td>Nurse         </td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>The survey respondent has the “task” of choosing one of the two profiles. Then, the researchers display a new task, including profiles with different randomized attributes, and the respondent chooses again.</p>
<p>By analyzing the choices made by participants, researchers can estimate the relative importance of different attributes in the decision-making process.</p>
<p>The rest of this vignette shows how to use the <code>marginaleffects</code> package to estimate the main quantities of the quantities of interest in such experiments.</p>
<section id="data" class="level1"><h1>Data</h1>
<p>To illustrate, we use data published alongside the <em>Political Analysis</em> article by <span class="citation" data-cites="HaiHopYam2014">Hainmueller, Hopkins, and Yamamoto (<a href="#ref-HaiHopYam2014" role="doc-biblioref">2014</a>)</span>. In this experiment, each survey respondent <span class="math inline">\(i\)</span> receives several tasks <span class="math inline">\(k\)</span>, in which they select one of two profiles <span class="math inline">\(j\)</span>, characterized by attributes <span class="math inline">\(l\)</span>.</p>
<p>For simplicity, we consider a subset of the data with 5 tasks per respondent, 2 profiles per task, and 2 attributes per profile. The data is structured in “long” format, with one respondent-task-profile combination per row.</p>
<p>These are the entries for survey respondent number 4:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marginaleffects.com/">marginaleffects</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/tinytable/">tinytable</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="st">"https://marginaleffects.com/data/conjoint_immigration.rds"</span>, <span class="st">"rb"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">respondent</span> <span class="op">==</span> <span class="fl">4</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    choice                 job         language respondent  task profile
     &lt;num&gt;              &lt;fctr&gt;           &lt;fctr&gt;      &lt;int&gt; &lt;int&gt;   &lt;num&gt;
 1:      1               nurse tried but unable          4     1       1
 2:      0 child care provider used interpreter          4     1       2
 3:      0            gardener           fluent          4     2       1
 4:      1 construction worker           fluent          4     2       2
 5:      1               nurse           broken          4     3       1
 6:      0 child care provider           fluent          4     3       2
 7:      0             teacher used interpreter          4     4       1
 8:      1 construction worker           fluent          4     4       2
 9:      1             teacher used interpreter          4     5       1
10:      0               nurse used interpreter          4     5       2</code></pre>
</div>
</div>
<p>The <code>choice</code> column indicates if the profile in each row was selected by the respondent.</p>
<p>These data are structured in what could be called a “long” format. Later on in the vignette, it will be useful to have information in a “wide” format, with new columns indicating what attributes characterized every profile in each task. To create these new columns, we use <code><a href="https://rdatatable.gitlab.io/data.table/reference/dcast.data.table.html">dcast()</a></code> from the <code>data.table</code> package. This function is analogous to <code><a href="https://rdrr.io/r/stats/reshape.html">reshape()</a></code> in base <code>R</code> or <code>pivot_wider()</code> in the <code>tidyverse</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/dcast.data.table.html">dcast</a></span><span class="op">(</span><span class="va">dat</span>, </span>
<span>  <span class="va">respondent</span> <span class="op">+</span> <span class="va">task</span> <span class="op">~</span> <span class="va">profile</span>,</span>
<span>  value.var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"language"</span>, <span class="st">"job"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">wide</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now have new columns called <code>language_1</code> and <code>language_2</code> indicating the language skills of profiles 1 and 2 respectively in each task.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">respondent</span> <span class="op">==</span> <span class="fl">4</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;respondent, task&gt;
    respondent  task choice                 job         language profile       language_1       language_2    job_1               job_2
         &lt;int&gt; &lt;int&gt;  &lt;num&gt;              &lt;fctr&gt;           &lt;fctr&gt;   &lt;num&gt;           &lt;fctr&gt;           &lt;fctr&gt;   &lt;fctr&gt;              &lt;fctr&gt;
 1:          4     1      1               nurse tried but unable       1 tried but unable used interpreter    nurse child care provider
 2:          4     1      0 child care provider used interpreter       2 tried but unable used interpreter    nurse child care provider
 3:          4     2      0            gardener           fluent       1           fluent           fluent gardener construction worker
 4:          4     2      1 construction worker           fluent       2           fluent           fluent gardener construction worker
 5:          4     3      1               nurse           broken       1           broken           fluent    nurse child care provider
 6:          4     3      0 child care provider           fluent       2           broken           fluent    nurse child care provider
 7:          4     4      0             teacher used interpreter       1 used interpreter           fluent  teacher construction worker
 8:          4     4      1 construction worker           fluent       2 used interpreter           fluent  teacher construction worker
 9:          4     5      1             teacher used interpreter       1 used interpreter used interpreter  teacher               nurse
10:          4     5      0               nurse used interpreter       2 used interpreter used interpreter  teacher               nurse</code></pre>
</div>
</div>
</section><section id="marginal-means" class="level1"><h1>Marginal means</h1>
<p>As described by <span class="citation" data-cites="LeeHobTil2020">Leeper, Hobolt, and Tilley (<a href="#ref-LeeHobTil2020" role="doc-biblioref">2020</a>)</span>, a “marginal mean describes the level of favorability toward profiles that have a particular feature level, ignoring all other features.”</p>
<p>To compute marginal means, we proceed in 3 steps:</p>
<ol type="1">
<li>Estimate a regression model with <code>choice</code> as outcome and the attributes of interest as predictors.</li>
<li>Compute the predicted (i.e., fitted) values for each row in the original dataset.</li>
<li>Marginalize (average) those predictions with respect to the variable of interest.</li>
</ol>
<p>To illustrate, we estimate a linear regression model with interactions between the <code>language</code> and <code>job</code> variables:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">choice</span> <span class="op">~</span> <span class="va">job</span> <span class="op">*</span> <span class="va">language</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we use the <code><a href="https://marginaleffects.com/man/predictions.html">avg_predictions()</a></code> function to compute and marginalize predicted values. Note that we use the <code>vcov</code> argument to report clustered standard errors at the respondent-level.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/predictions.html">avg_predictions</a></span><span class="op">(</span><span class="va">mod</span>, by <span class="op">=</span> <span class="st">"language"</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">respondent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
         language Estimate Std. Error    z Pr(&gt;|z|)   S 2.5 % 97.5 %
 tried but unable    0.459    0.00733 62.7   &lt;0.001 Inf 0.445  0.474
 used interpreter    0.424    0.00749 56.6   &lt;0.001 Inf 0.410  0.439
 fluent              0.588    0.00726 81.0   &lt;0.001 Inf 0.573  0.602
 broken              0.526    0.00746 70.6   &lt;0.001 Inf 0.512  0.541

Type:  response 
Columns: language, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high </code></pre>
</div>
</div>
<p>The results above suggests that, ignoring (or averaging over) the <code>job</code> attribute, the “fluent” English speakers are chosen more often than profiles with other <code>language</code> values.</p>
<section id="hypothesis-tests" class="level2"><h2 class="anchored" data-anchor-id="hypothesis-tests">Hypothesis tests</h2>
<p>Using the <code>hypothesis</code> argument, we can easily conduct various null hypothesis tests on the estimated marginal means. For example, is the probability of choosing a “fluent” profile equal to the probability of choosing a “tried but unable” profile?</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/predictions.html">avg_predictions</a></span><span class="op">(</span><span class="va">mod</span>, </span>
<span>  hypothesis <span class="op">=</span> <span class="st">"b1 = b3"</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"language"</span>, </span>
<span>  vcov <span class="op">=</span> <span class="op">~</span><span class="va">respondent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Estimate Std. Error     z Pr(&gt;|z|)    S  2.5 % 97.5 %
   -0.128     0.0119 -10.8   &lt;0.001 87.6 -0.152 -0.105

Term: b1=b3
Type:  response 
Columns: term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high </code></pre>
</div>
</div>
<p>Is the difference in probabiliy between “fluent” and “broken” equal to the difference in probability between “tried but unable” and “used interpreter”?</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/predictions.html">avg_predictions</a></span><span class="op">(</span><span class="va">mod</span>, </span>
<span>  hypothesis <span class="op">=</span> <span class="st">"b1 - b2 = b3 - b4"</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"language"</span>, </span>
<span>  vcov <span class="op">=</span> <span class="op">~</span><span class="va">respondent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Estimate Std. Error     z Pr(&gt;|z|)   S   2.5 %  97.5 %
  -0.0264     0.0168 -1.57    0.116 3.1 -0.0594 0.00657

Term: b1-b2=b3-b4
Type:  response 
Columns: term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high </code></pre>
</div>
</div>
</section><section id="subgroups" class="level2"><h2 class="anchored" data-anchor-id="subgroups">Subgroups</h2>
<p>Modifying the <code>by</code> allows analysts to report marginal means for different subgroups of their data, and <code>newdata</code> can be used to exclude uninteresting profiles:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/predictions.html">avg_predictions</a></span><span class="op">(</span><span class="va">mod</span>, </span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"language"</span>, <span class="st">"job"</span><span class="op">)</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">job</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"doctor"</span>, <span class="st">"gardener"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  vcov <span class="op">=</span> <span class="op">~</span><span class="va">respondent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
         language      job Estimate Std. Error    z Pr(&gt;|z|)     S 2.5 % 97.5 %
 fluent           gardener    0.534     0.0243 22.0   &lt;0.001 353.5 0.486  0.581
 fluent           doctor      0.772     0.0332 23.2   &lt;0.001 394.4 0.707  0.837
 used interpreter doctor      0.602     0.0427 14.1   &lt;0.001 147.5 0.518  0.685
 tried but unable gardener    0.416     0.0237 17.5   &lt;0.001 226.5 0.370  0.463
 used interpreter gardener    0.387     0.0244 15.8   &lt;0.001 185.1 0.339  0.435
 broken           gardener    0.509     0.0245 20.8   &lt;0.001 317.0 0.461  0.557
 tried but unable doctor      0.570     0.0443 12.9   &lt;0.001 123.5 0.483  0.657
 broken           doctor      0.712     0.0394 18.1   &lt;0.001 239.6 0.635  0.789

Type:  response 
Columns: language, job, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high </code></pre>
</div>
</div>
</section></section><section id="average-marginal-component-effects" class="level1"><h1>Average Marginal Component Effects</h1>
<p>Average Marginal Component Effects (AMCE) are defined and analyzed in <span class="citation" data-cites="HaiHopYam2014">Hainmueller, Hopkins, and Yamamoto (<a href="#ref-HaiHopYam2014" role="doc-biblioref">2014</a>)</span>. Roughly speaking, they can be viewed as the average effects of changing one attribute on choice, while holding all other attributes of the profile constant. To compute an AMCE, we can proceed in 4 steps:</p>
<ol type="1">
<li>Create a dataset A where the <code>language</code> column is equal to “fluent English” in every row.</li>
<li>Create a dataset B where the <code>language</code> column is equal to “broken English” in every row.</li>
<li>Compute predicted (fitted) values for every row in datasets A and B.</li>
<li>Compute the average difference between predicted values in the two datasets.</li>
</ol>
<p>This can be achieved easily using the <code><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons()</a></code> function from the <code>marginaleffects</code> package:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="st">"language"</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">respondent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                              Contrast Estimate Std. Error      z Pr(&gt;|z|)     S   2.5 %  97.5 %
 mean(broken) - mean(fluent)            -0.0592     0.0120  -4.95   &lt;0.001  20.4 -0.0826 -0.0357
 mean(tried but unable) - mean(fluent)  -0.1271     0.0119 -10.66   &lt;0.001  85.7 -0.1504 -0.1037
 mean(used interpreter) - mean(fluent)  -0.1608     0.0121 -13.27   &lt;0.001 131.2 -0.1845 -0.1370

Term: language
Type:  response 
Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted </code></pre>
</div>
</div>
<section id="empirical-vs.-balanced-grid" class="level2"><h2 class="anchored" data-anchor-id="empirical-vs.-balanced-grid">Empirical vs.&nbsp;balanced grid</h2>
<p>In the example above, <code><a href="https://marginaleffects.com/man/predictions.html">avg_predictions()</a></code> marginalized across the realized distribution of attributes observed in the actual dataset. An alternative would be to marginalzed over a perfectly balanced (“uniform”) grid of treatment conditions. Of course, empirical and uniform grids will yield nearly identical results if the sample is large and randomization successful.</p>
<p>The uniform approach is the default in the <code><a href="https://rdrr.io/pkg/cjoint/man/amce.html">amce()</a></code> function from the <code>cjoint</code> package, and the behavior can be replicated using the <code><a href="https://marginaleffects.com/man/datagrid.html">datagrid()</a></code> function and the <code>newdata</code> argument in <code><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">cjoint</span><span class="op">)</span></span>
<span></span>
<span><span class="va">amce_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cjoint/man/amce.html">amce</a></span><span class="op">(</span></span>
<span>  <span class="va">choice</span> <span class="op">~</span> <span class="va">language</span> <span class="op">*</span> <span class="va">job</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>  cluster <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  respondent.id <span class="op">=</span> <span class="st">"respondent"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">amce_results</span><span class="op">)</span><span class="op">$</span><span class="va">amce</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Attribute</span> <span class="op">==</span> <span class="st">"language"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Attribute            Level    Estimate   Std. Err    z value     Pr(&gt;|z|)    
11  language           broken -0.06834528 0.01357451  -5.034826 4.782835e-07 ***
12  language tried but unable -0.12843978 0.01343677  -9.558832 1.190935e-21 ***
13  language used interpreter -0.16584337 0.01382564 -11.995352 3.758141e-33 ***</code></pre>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>FUN_factor <span class="op">=</span> <span class="va">unique</span>, FUN_character <span class="op">=</span> <span class="va">unique</span><span class="op">)</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"language"</span>,</span>
<span>  vcov <span class="op">=</span> <span class="op">~</span><span class="va">respondent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                              Contrast Estimate Std. Error      z Pr(&gt;|z|)     S  2.5 %  97.5 %
 mean(broken) - mean(fluent)            -0.0683     0.0136  -5.03   &lt;0.001  21.0 -0.095 -0.0417
 mean(tried but unable) - mean(fluent)  -0.1284     0.0134  -9.56   &lt;0.001  69.5 -0.155 -0.1021
 mean(used interpreter) - mean(fluent)  -0.1658     0.0138 -12.00   &lt;0.001 107.7 -0.193 -0.1387

Term: language
Type:  response 
Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted </code></pre>
</div>
</div>
</section></section><section id="average-feature-choice-probability" class="level1"><h1>Average Feature Choice Probability</h1>
<p><span class="citation" data-cites="Abr2024">Abramson et al. (<a href="#ref-Abr2024" role="doc-biblioref">2024</a>)</span> introduce an alternative estimand for forced-choice conjoint experiments: the Average Feature Choice Probability (AFCP). The main difference between AMCE and AFCP lies in their approach to handling attribute comparisons.</p>
<p>AMCE incorporates comparisons and averages over both direct and indirect attribute comparisons, potentially considering information about irrelevant attributes, thus imposing a strong transitivity assumption. In some cases, AMCE can suggest positive effects even when, in direct comparisons, respondents are on average less likely to choose a profile with the feature of interest over the baseline. In contrast, AFCP focuses solely on direct comparisons between attributes, offering a more accurate representation of respondents’ direct preferences without the influence of irrelevant attributes.</p>
<p>To estimate AFCP, we once again start by estimating a linear regression model. This time, the model is even more flexible. Specifically, the model allows the effect of language skills in the first profile to depend on the value of language skills in the second profile. Likewise, other attributes can influence the probability of selection differently based on attributes in the comparison profile. To achieve this, we interact <code>language_1</code> with <code>language_2</code>, and <code>job_1</code> with <code>job_2</code>.</p>
<p>Moreover, since the data is in “long” format, with one profile per row, we must also allow each variable to have different coefficients based on <code>profile</code> number: the effect of <code>language_1</code> on the probability of selection is obviously different for <code>profile=1</code> and for <code>profile=2</code>. Indeed, when <code>profile=1</code> the <code>language_1</code> column records the profile’s own language skills. When <code>profile=2</code>, the same column records the alternative profile’s language skills.</p>
<p>Thankfully, it is trivial to allow this flexibility by interacting the attributes with the <code>profile</code> variable:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">choice</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">profile</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">language_1</span> <span class="op">*</span> <span class="va">language_2</span> <span class="op">+</span> <span class="va">job_1</span> <span class="op">*</span> <span class="va">job_2</span><span class="op">)</span>, <span class="va">dat</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As explained above and detailed in <span class="citation" data-cites="Abr2024">Abramson et al. (<a href="#ref-Abr2024" role="doc-biblioref">2024</a>)</span>, the AFCP is a choice pair-specific quantity. This means that we need to average predictions (fitted values) across covariates, within each unique pair of attributes of interest. To allow this, we create a new variable called <code>alternative</code>:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dat</span><span class="op">$</span><span class="va">alternative</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fifelse.html">fifelse</a></span><span class="op">(</span></span>
<span>  <span class="va">dat</span><span class="op">$</span><span class="va">language</span> <span class="op">==</span> <span class="va">dat</span><span class="op">$</span><span class="va">language_1</span>, </span>
<span>  <span class="va">dat</span><span class="op">$</span><span class="va">language_2</span>, </span>
<span>  <span class="va">dat</span><span class="op">$</span><span class="va">language_1</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This table shows the language skills and job of both profiles in the first task faced by respondent number 4. The <code>alternative</code> column simply shows the language skills of the alternative profile within each task:</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dat</span>,</span>
<span>  <span class="va">task</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">respondent</span> <span class="op">==</span> <span class="fl">4</span>, </span>
<span>  select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"respondent"</span>, <span class="st">"task"</span>, <span class="st">"profile"</span>, <span class="st">"job"</span>, <span class="st">"language"</span>, <span class="st">"alternative"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://vincentarelbundock.github.io/tinytable/man/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_ilq434eqfgywhb7y56si(i, j, css_id) {
        var table = document.getElementById("tinytable_ilq434eqfgywhb7y56si");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_ilq434eqfgywhb7y56si');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_ilq434eqfgywhb7y56si(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_ilq434eqfgywhb7y56si");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_ilq434eqfgywhb7y56si(0, 0, 'tinytable_css_idtp33wels8w7ifghfoino') })
window.addEventListener('load', function () { styleCell_ilq434eqfgywhb7y56si(0, 1, 'tinytable_css_idtp33wels8w7ifghfoino') })
window.addEventListener('load', function () { styleCell_ilq434eqfgywhb7y56si(0, 2, 'tinytable_css_idtp33wels8w7ifghfoino') })
window.addEventListener('load', function () { styleCell_ilq434eqfgywhb7y56si(0, 3, 'tinytable_css_idtp33wels8w7ifghfoino') })
window.addEventListener('load', function () { styleCell_ilq434eqfgywhb7y56si(0, 4, 'tinytable_css_idtp33wels8w7ifghfoino') })
window.addEventListener('load', function () { styleCell_ilq434eqfgywhb7y56si(0, 5, 'tinytable_css_idtp33wels8w7ifghfoino') })
    </script><style>
    .table td.tinytable_css_idtp33wels8w7ifghfoino, .table th.tinytable_css_idtp33wels8w7ifghfoino {  border-bottom: solid 0.1em #d3d8dc; }
    </style>
<div class="container">
      <table class="table table-borderless" id="tinytable_ilq434eqfgywhb7y56si" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead><tr>
<th scope="col">respondent</th>
                <th scope="col">task</th>
                <th scope="col">profile</th>
                <th scope="col">job</th>
                <th scope="col">language</th>
                <th scope="col">alternative</th>
              </tr></thead>
<tbody>
<tr>
<td>4</td>
                  <td>1</td>
                  <td>1</td>
                  <td>nurse              </td>
                  <td>tried but unable</td>
                  <td>used interpreter</td>
                </tr>
<tr>
<td>4</td>
                  <td>1</td>
                  <td>2</td>
                  <td>child care provider</td>
                  <td>used interpreter</td>
                  <td>tried but unable</td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Now we compute the AFCP by averaging fitted values by unique pairs of attributes for language (the combination of <code>language</code> and <code>alternative</code>). Since we are not interested comparison pairs where both profiles have the same language skills, we use the <code>subset</code> to supply an appropriate grid.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://marginaleffects.com/man/predictions.html">avg_predictions</a></span><span class="op">(</span><span class="va">mod</span>, </span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"language"</span>, <span class="st">"alternative"</span><span class="op">)</span>, </span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">language</span> <span class="op">!=</span> <span class="va">alternative</span><span class="op">)</span>,</span>
<span>  vcov <span class="op">=</span> <span class="op">~</span><span class="va">respondent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Display the results in a nice <code>tinytable</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/tinytable/">tinytable</a></span><span class="op">)</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">alternative</span> <span class="op">==</span> <span class="st">"fluent"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p</span>, <span class="st">"tinytable"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://vincentarelbundock.github.io/tinytable/man/style_tt.html">style_tt</a></span><span class="op">(</span>i <span class="op">=</span> <span class="va">idx</span>, background <span class="op">=</span> <span class="st">"pink"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_8r5c2fp6bi1260mnc3ku(i, j, css_id) {
        var table = document.getElementById("tinytable_8r5c2fp6bi1260mnc3ku");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_8r5c2fp6bi1260mnc3ku');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_8r5c2fp6bi1260mnc3ku(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_8r5c2fp6bi1260mnc3ku");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(0, 0, 'tinytable_css_id3efggn2srzrzu9tm0m3l') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(0, 1, 'tinytable_css_id3efggn2srzrzu9tm0m3l') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(0, 2, 'tinytable_css_id3efggn2srzrzu9tm0m3l') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(0, 3, 'tinytable_css_id3efggn2srzrzu9tm0m3l') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(0, 4, 'tinytable_css_id3efggn2srzrzu9tm0m3l') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(0, 5, 'tinytable_css_id3efggn2srzrzu9tm0m3l') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(0, 6, 'tinytable_css_id3efggn2srzrzu9tm0m3l') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(0, 7, 'tinytable_css_id3efggn2srzrzu9tm0m3l') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(0, 8, 'tinytable_css_id3efggn2srzrzu9tm0m3l') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(3, 0, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(3, 1, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(3, 2, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(3, 3, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(3, 4, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(3, 5, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(3, 6, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(3, 7, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(3, 8, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(5, 0, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(5, 1, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(5, 2, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(5, 3, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(5, 4, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(5, 5, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(5, 6, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(5, 7, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(5, 8, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(12, 0, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(12, 1, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(12, 2, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(12, 3, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(12, 4, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(12, 5, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(12, 6, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(12, 7, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(12, 8, 'tinytable_css_idscar793fzvufo91fmxp6') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(13, 0, 'tinytable_css_idqusydgty5t6sw6z3i6gd') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(13, 1, 'tinytable_css_idqusydgty5t6sw6z3i6gd') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(13, 2, 'tinytable_css_idqusydgty5t6sw6z3i6gd') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(13, 3, 'tinytable_css_idqusydgty5t6sw6z3i6gd') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(13, 4, 'tinytable_css_idqusydgty5t6sw6z3i6gd') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(13, 5, 'tinytable_css_idqusydgty5t6sw6z3i6gd') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(13, 6, 'tinytable_css_idqusydgty5t6sw6z3i6gd') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(13, 7, 'tinytable_css_idqusydgty5t6sw6z3i6gd') })
window.addEventListener('load', function () { styleCell_8r5c2fp6bi1260mnc3ku(13, 8, 'tinytable_css_idqusydgty5t6sw6z3i6gd') })
    </script><style>
    .table td.tinytable_css_id3efggn2srzrzu9tm0m3l, .table th.tinytable_css_id3efggn2srzrzu9tm0m3l {  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idscar793fzvufo91fmxp6, .table th.tinytable_css_idscar793fzvufo91fmxp6 {  background-color: pink; }
    .table td.tinytable_css_idqusydgty5t6sw6z3i6gd, .table th.tinytable_css_idqusydgty5t6sw6z3i6gd {  text-align: left; }
    </style>
<div class="container">
      <table class="table table-borderless" id="tinytable_8r5c2fp6bi1260mnc3ku" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead><tr>
<th scope="col">language</th>
                <th scope="col">alternative</th>
                <th scope="col">Estimate</th>
                <th scope="col">Std. Error</th>
                <th scope="col">z</th>
                <th scope="col">Pr(&gt;|z|)</th>
                <th scope="col">S</th>
                <th scope="col">2.5 %</th>
                <th scope="col">97.5 %</th>
              </tr></thead>
<tfoot>
<tr><td colspan="9">Type:  response 
</td></tr>
<tr><td colspan="9">Columns: language, alternative, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
</td></tr>
</tfoot>
<tbody>
<tr>
<td>tried but unable</td>
                  <td>used interpreter</td>
                  <td>0.541</td>
                  <td>0.0183</td>
                  <td>29.7</td>
                  <td>&lt;0.001</td>
                  <td>639.5</td>
                  <td>0.505</td>
                  <td>0.577</td>
                </tr>
<tr>
<td>used interpreter</td>
                  <td>tried but unable</td>
                  <td>0.459</td>
                  <td>0.0183</td>
                  <td>25.1</td>
                  <td>&lt;0.001</td>
                  <td>460.9</td>
                  <td>0.423</td>
                  <td>0.495</td>
                </tr>
<tr>
<td>broken          </td>
                  <td>fluent          </td>
                  <td>0.407</td>
                  <td>0.0164</td>
                  <td>24.8</td>
                  <td>&lt;0.001</td>
                  <td>447.7</td>
                  <td>0.375</td>
                  <td>0.439</td>
                </tr>
<tr>
<td>fluent          </td>
                  <td>broken          </td>
                  <td>0.593</td>
                  <td>0.0164</td>
                  <td>36.1</td>
                  <td>&lt;0.001</td>
                  <td>947.4</td>
                  <td>0.561</td>
                  <td>0.625</td>
                </tr>
<tr>
<td>used interpreter</td>
                  <td>fluent          </td>
                  <td>0.361</td>
                  <td>0.0157</td>
                  <td>22.9</td>
                  <td>&lt;0.001</td>
                  <td>384.5</td>
                  <td>0.330</td>
                  <td>0.392</td>
                </tr>
<tr>
<td>fluent          </td>
                  <td>used interpreter</td>
                  <td>0.639</td>
                  <td>0.0157</td>
                  <td>40.6</td>
                  <td>&lt;0.001</td>
                  <td>Inf</td>
                  <td>0.608</td>
                  <td>0.670</td>
                </tr>
<tr>
<td>broken          </td>
                  <td>tried but unable</td>
                  <td>0.577</td>
                  <td>0.0166</td>
                  <td>34.7</td>
                  <td>&lt;0.001</td>
                  <td>874.9</td>
                  <td>0.544</td>
                  <td>0.609</td>
                </tr>
<tr>
<td>tried but unable</td>
                  <td>broken          </td>
                  <td>0.423</td>
                  <td>0.0166</td>
                  <td>25.5</td>
                  <td>&lt;0.001</td>
                  <td>474.1</td>
                  <td>0.391</td>
                  <td>0.456</td>
                </tr>
<tr>
<td>used interpreter</td>
                  <td>broken          </td>
                  <td>0.381</td>
                  <td>0.0163</td>
                  <td>23.3</td>
                  <td>&lt;0.001</td>
                  <td>396.6</td>
                  <td>0.349</td>
                  <td>0.413</td>
                </tr>
<tr>
<td>broken          </td>
                  <td>used interpreter</td>
                  <td>0.619</td>
                  <td>0.0163</td>
                  <td>37.9</td>
                  <td>&lt;0.001</td>
                  <td>Inf</td>
                  <td>0.587</td>
                  <td>0.651</td>
                </tr>
<tr>
<td>fluent          </td>
                  <td>tried but unable</td>
                  <td>0.624</td>
                  <td>0.0165</td>
                  <td>37.7</td>
                  <td>&lt;0.001</td>
                  <td>Inf</td>
                  <td>0.591</td>
                  <td>0.656</td>
                </tr>
<tr>
<td>tried but unable</td>
                  <td>fluent          </td>
                  <td>0.376</td>
                  <td>0.0165</td>
                  <td>22.8</td>
                  <td>&lt;0.001</td>
                  <td>378.4</td>
                  <td>0.344</td>
                  <td>0.409</td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>The results in pink are the same as those produced by <a href="https://github.com/astrezhnev/afcp">the <code>afcp</code> package:</a></p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">afcp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">afcp_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/afcp/man/afcp.html">afcp</a></span><span class="op">(</span></span>
<span>  <span class="va">amce_results</span>,</span>
<span>  respondent.id <span class="op">=</span> <span class="st">"respondent"</span>,</span>
<span>  task.id <span class="op">=</span> <span class="st">"task"</span>,</span>
<span>  profile.id <span class="op">=</span> <span class="st">"profile"</span>,</span>
<span>  attribute <span class="op">=</span> <span class="st">"language"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">afcp_results</span><span class="op">$</span><span class="va">afcp</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            level baseline      afcp         se     zstat         pval conf_high  conf_low conf_level
1          broken   fluent 0.4067416 0.01658803 -5.622030 1.887265e-08 0.4392535 0.3742296       0.95
2  triedbutunable   fluent 0.3763066 0.01685034 -7.340705 2.124724e-13 0.4093327 0.3432806       0.95
3 usedinterpreter   fluent 0.3610799 0.01592112 -8.725525 2.649493e-18 0.3922847 0.3298750       0.95</code></pre>
</div>
</div>
<section id="hypothesis-tests-1" class="level2"><h2 class="anchored" data-anchor-id="hypothesis-tests-1">Hypothesis tests</h2>
<p>A powerful feature of <code>marginaleffects</code> is that all its functions include a <code>hypothesis</code> argument which can be used to conduct hypothesis tests on arbitrary functions of estimates. For example, let’s compute the AFCP for a subset of profile comparisons:</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://marginaleffects.com/man/predictions.html">avg_predictions</a></span><span class="op">(</span><span class="va">mod</span>, </span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"language"</span>, <span class="st">"alternative"</span><span class="op">)</span>, </span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">language</span> <span class="op">!=</span> <span class="va">alternative</span> <span class="op">&amp;</span> <span class="va">alternative</span> <span class="op">==</span> <span class="st">"fluent"</span><span class="op">)</span>,</span>
<span>  vcov <span class="op">=</span> <span class="op">~</span><span class="va">respondent</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
         language alternative Estimate Std. Error    z Pr(&gt;|z|)     S 2.5 % 97.5 %
 broken                fluent    0.407     0.0164 24.8   &lt;0.001 447.7 0.375  0.439
 used interpreter      fluent    0.361     0.0157 22.9   &lt;0.001 384.5 0.330  0.392
 tried but unable      fluent    0.376     0.0165 22.8   &lt;0.001 378.4 0.344  0.409

Type:  response 
Columns: language, alternative, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high </code></pre>
</div>
</div>
<p>Now, let’s say we would like to test if any of the pairwise comparisons between AFCP is different from zero. All we need to do is use add a <code>hypothesis="pairwise"</code> argument:</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/predictions.html">avg_predictions</a></span><span class="op">(</span><span class="va">mod</span>, </span>
<span>  hypothesis <span class="op">=</span> <span class="st">"pairwise"</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"language"</span>, <span class="st">"alternative"</span><span class="op">)</span>, </span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">language</span> <span class="op">!=</span> <span class="va">alternative</span> <span class="op">&amp;</span> <span class="va">alternative</span> <span class="op">==</span> <span class="st">"fluent"</span><span class="op">)</span>,</span>
<span>  vcov <span class="op">=</span> <span class="op">~</span><span class="va">respondent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                                Term Estimate Std. Error     z Pr(&gt;|z|)   S    2.5 % 97.5 %
 broken - used interpreter             0.0457     0.0226  2.02   0.0429 4.5  0.00146 0.0899
 broken - tried but unable             0.0304     0.0228  1.34   0.1811 2.5 -0.01417 0.0750
 used interpreter - tried but unable  -0.0152     0.0224 -0.68   0.4968 1.0 -0.05915 0.0287

Type:  response 
Columns: term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high </code></pre>
</div>
</div>



</section></section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Abr2024" class="csl-entry" role="listitem">
Abramson, Scott F, Korhan Kocak, Asya Magazinnik, and Anton Strezhnev. 2024. <span>“Detecting Preference Cycles in Forced-Choice Conjoint Experiments.”</span> SocArXiv. <a href="https://doi.org/10.31235/osf.io/xjre9">https://doi.org/10.31235/osf.io/xjre9</a>.
</div>
<div id="ref-HaiHopYam2014" class="csl-entry" role="listitem">
Hainmueller, J., D. Hopkins, and T. Yamamoto. 2014. <span>“Causal Inference in Conjoint Analysis: Understanding Multi-Dimensional Choices via Stated Preference Experiments.”</span> <em>Political Analysis</em> 22 (1): 1–30.
</div>
<div id="ref-LeeHobTil2020" class="csl-entry" role="listitem">
Leeper, Thomas J., Sara B. Hobolt, and James Tilley. 2020. <span>“Measuring Subgroup Preferences in Conjoint Experiments.”</span> <em>Political Analysis</em> 28 (2): 207–21. <a href="https://doi.org/10.1017/pan.2019.30">https://doi.org/10.1017/pan.2019.30</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>The <code><a href="https://rdatatable.gitlab.io/data.table/reference/fifelse.html">fifelse()</a></code> function from <code>data.table</code> preserves factor levels, but not the standard <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../vignettes/conformal.html" class="pagination-link" aria-label="Conformal prediction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Conformal prediction</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../vignettes/elasticity.html" class="pagination-link" aria-label="Elasticity">
        <span class="nav-page-text">Elasticity</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>