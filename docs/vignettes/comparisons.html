<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.43">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Marginal Effects Zoo – Comparisons</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../vignettes/slopes.html" rel="next">
<link href="../vignettes/predictions.html" rel="prev">
<link href="../images/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/marginaleffects_icon.png" alt="marginaleffects logo" class="navbar-logo"></a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Marginal Effects Zoo</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link active" href="../vignettes/get_started.html" aria-current="page"> 
<span class="menu-text">Get started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../files/marginaleffects_arel-bundock_greifer_heiss_jss5115.pdf"> 
<span class="menu-text">Article</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../vignettes/help.html"> 
<span class="menu-text">Help</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/vincentarelbundock/marginaleffects"> <i class="bi bi-github" role="img" aria-label="marginaleffects GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/vincentab"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../vignettes/predictions.html">Tutorials</a></li><li class="breadcrumb-item"><a href="../vignettes/comparisons.html">Comparisons</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/get_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Get started</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Predictions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/comparisons.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Comparisons</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/slopes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Slopes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/hypothesis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hypothesis Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Plots</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Case studies</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/brms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/bootstrap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bootstrap &amp; Simulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/categorical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Categorical outcomes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/conformal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conformal prediction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/conjoint.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conjoint experiments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/elasticity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Elasticity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/equivalence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Equivalence Tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Experiments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/gam.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GAM</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/gcomputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">G-Computation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/heterogeneity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Heterogeneity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/interactions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interactions, polynomials, and splines</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/ipw.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Inverse Probability Weighting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/logit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Logit</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/lme4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mixed Effects</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/machine_learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Machine Learning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/marginalmeans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Marginal Means</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Matching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/mrp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MrP</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/multiple_imputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Missing Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/svalues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">S Values</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Miscellaneous</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Help</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/faq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FAQ</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/meme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Meme gallery</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/alternative_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Alternative Software</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/extensions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Extensions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/links.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Links</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/performance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/numpyro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NumPyro</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/supported_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Supported Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vignettes/uncertainty.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Standard Errors</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Functions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>predictions</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/comparisons.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>comparisons</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/slopes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>slopes</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/plot_predictions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>plot_predictions</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/plot_comparisons.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>plot_comparisons</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/plot_slopes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>plot_slopes</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/hypotheses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>hypotheses</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/inferences.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>inferences</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/posterior_draws.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>posterior_draws</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/datagrid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>datagrid</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../man/print.marginaleffects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>print.marginaleffects</code></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../NEWS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">News</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LICENSE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">License</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../CITATION.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Citation</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#definition-and-motivation" id="toc-definition-and-motivation" class="nav-link active" data-scroll-target="#definition-and-motivation">Definition and motivation</a></li>
  <li>
<a href="#quantity-of-interest" id="toc-quantity-of-interest" class="nav-link" data-scroll-target="#quantity-of-interest">Quantity of interest</a>
  <ul class="collapse">
<li>
<a href="#comparison-type" id="toc-comparison-type" class="nav-link" data-scroll-target="#comparison-type">Comparison type</a>
  <ul class="collapse">
<li><a href="#differences" id="toc-differences" class="nav-link" data-scroll-target="#differences">Differences</a></li>
  <li><a href="#ratios" id="toc-ratios" class="nav-link" data-scroll-target="#ratios">Ratios</a></li>
  <li><a href="#built-in-functions" id="toc-built-in-functions" class="nav-link" data-scroll-target="#built-in-functions">Built-in functions</a></li>
  <li><a href="#custom-functions" id="toc-custom-functions" class="nav-link" data-scroll-target="#custom-functions">Custom functions</a></li>
  </ul>
</li>
  <li>
<a href="#predictor-types" id="toc-predictor-types" class="nav-link" data-scroll-target="#predictor-types">Predictor types</a>
  <ul class="collapse">
<li><a href="#numeric" id="toc-numeric" class="nav-link" data-scroll-target="#numeric">Numeric</a></li>
  <li><a href="#binary-or-logical" id="toc-binary-or-logical" class="nav-link" data-scroll-target="#binary-or-logical">Binary or Logical</a></li>
  <li><a href="#factor-or-character" id="toc-factor-or-character" class="nav-link" data-scroll-target="#factor-or-character">Factor or Character</a></li>
  <li><a href="#cross-contrasts" id="toc-cross-contrasts" class="nav-link" data-scroll-target="#cross-contrasts">Cross-contrasts</a></li>
  </ul>
</li>
  <li><a href="#outcome-type" id="toc-outcome-type" class="nav-link" data-scroll-target="#outcome-type">Outcome type</a></li>
  </ul>
</li>
  <li>
<a href="#grid" id="toc-grid" class="nav-link" data-scroll-target="#grid">Grid</a>
  <ul class="collapse">
<li><a href="#empirical-distribution" id="toc-empirical-distribution" class="nav-link" data-scroll-target="#empirical-distribution">Empirical distribution</a></li>
  <li><a href="#user-specified-values" id="toc-user-specified-values" class="nav-link" data-scroll-target="#user-specified-values">User-specified values</a></li>
  <li><a href="#representative-values" id="toc-representative-values" class="nav-link" data-scroll-target="#representative-values">Representative values</a></li>
  <li><a href="#balanced-grids" id="toc-balanced-grids" class="nav-link" data-scroll-target="#balanced-grids">Balanced grids</a></li>
  </ul>
</li>
  <li>
<a href="#aggregation" id="toc-aggregation" class="nav-link" data-scroll-target="#aggregation">Aggregation</a>
  <ul class="collapse">
<li><a href="#subgroups" id="toc-subgroups" class="nav-link" data-scroll-target="#subgroups">Subgroups</a></li>
  <li><a href="#marginal-means" id="toc-marginal-means" class="nav-link" data-scroll-target="#marginal-means">Marginal means</a></li>
  </ul>
</li>
  <li>
<a href="#uncertainty" id="toc-uncertainty" class="nav-link" data-scroll-target="#uncertainty">Uncertainty</a>
  <ul class="collapse">
<li><a href="#robust-clustered-standard-errors" id="toc-robust-clustered-standard-errors" class="nav-link" data-scroll-target="#robust-clustered-standard-errors">Robust (clustered) standard errors</a></li>
  <li><a href="#bootstrap-and-simulation" id="toc-bootstrap-and-simulation" class="nav-link" data-scroll-target="#bootstrap-and-simulation">Bootstrap and simulation</a></li>
  <li><a href="#transformation" id="toc-transformation" class="nav-link" data-scroll-target="#transformation">Transformation</a></li>
  </ul>
</li>
  <li><a href="#hypothesis" id="toc-hypothesis" class="nav-link" data-scroll-target="#hypothesis">Hypothesis</a></li>
  <li>
<a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization">Visualization</a>
  <ul class="collapse">
<li><a href="#customization" id="toc-customization" class="nav-link" data-scroll-target="#customization">Customization</a></li>
  </ul>
</li>
  <li><a href="#visual-guide" id="toc-visual-guide" class="nav-link" data-scroll-target="#visual-guide">Visual guide</a></li>
  <li>
<a href="#more" id="toc-more" class="nav-link" data-scroll-target="#more">More</a>
  <ul class="collapse">
<li><a href="#manual-computation" id="toc-manual-computation" class="nav-link" data-scroll-target="#manual-computation">Manual computation</a></li>
  <li><a href="#transformations" id="toc-transformations" class="nav-link" data-scroll-target="#transformations">Transformations</a></li>
  <li><a href="#difference-in-differences" id="toc-difference-in-differences" class="nav-link" data-scroll-target="#difference-in-differences">Difference-in-Differences</a></li>
  <li><a href="#forward-backward-centered" id="toc-forward-backward-centered" class="nav-link" data-scroll-target="#forward-backward-centered">Forward, Backward, Centered</a></li>
  <li><a href="#observation-wise-categorical-marginal-effect" id="toc-observation-wise-categorical-marginal-effect" class="nav-link" data-scroll-target="#observation-wise-categorical-marginal-effect">Observation-Wise Categorical Marginal Effect</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../vignettes/predictions.html">Tutorials</a></li><li class="breadcrumb-item"><a href="../vignettes/comparisons.html">Comparisons</a></li></ol></nav><div class="quarto-title">
<h1 class="title">Comparisons</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p><img src="fig/Domino.png" class="img-fluid" style="width:70.0%"></p>
<section id="definition-and-motivation" class="level1"><h1>Definition and motivation</h1>
<p>In this vignette, we introduce “comparisons”, defined as:</p>
<blockquote class="blockquote">
<p>Comparisons are functions of two or more predictions. Example of comparisons include contrasts, differences, risks ratios, odds, etc.</p>
</blockquote>
<p>A very large number of quantities of interest can be built as a function of two (or more) predictions. Indeed, with the <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> function, we can answer questions like these:</p>
<ul>
<li>
<em>Medical Treatment Efficacy</em>: How does probability of survival differ for patients who receive a new medication relative to a placebo?</li>
<li>
<em>Education Policy</em>: How do standardized test scores differ between students who attended preschool programs and those who did not?</li>
<li>
<em>Environmental Conservation</em>: What is the impact of new conseration policies on forest coverage?</li>
<li>
<em>Economic Development</em>: What difference does participation in microfinance programs make on household income?</li>
<li>
<em>Sports Performance</em>: How does the win ratio of teams change after the introduction of a new training regimen?</li>
<li>
<em>Cultural Studies</em>: What is the difference in cultural engagement levels between communities with access to public libraries and those without?</li>
</ul>
<p>Using the <code>hypothesis</code> argument of the <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> function, we will also be able to compare contrasts to one another, answering questions such as:</p>
<ul>
<li>Is the effect of an educational intervention on mathematical competency stronger for older or younger students?</li>
<li>Does a work training program in a carceral setting have a greater effect on the probability of recidivism for first or second time offenders?</li>
</ul>
<p>The <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> function is <em>extremely</em> flexible, and it allows users to estimate a vast array of quantities of interest. To describe those quantities, the vignette breaks the problem down into into 5 steps:</p>
<ol type="1">
<li>Quantity</li>
<li>Grid</li>
<li>Aggregation</li>
<li>Uncertainty</li>
<li>Test</li>
</ol>
<p>These steps can be combined, mixed, and matched to define and compute many different estimands.</p>
</section><section id="quantity-of-interest" class="level1"><h1>Quantity of interest</h1>
<p>To investigate the effect of gender, age, and passenger class on survival aboard the Titanic, we will conduct a series of “comparisons” between predicted outcomes computed for different preditor values. The quantity of interest will vary in two main respects:</p>
<ul>
<li>
<em>Predictor type</em>
<ul>
<li>How does the explanator of interest change?</li>
<li>Ex: +1 on a numeric variable, or the difference between a factor level and its baseline.</li>
</ul>
</li>
<li>
<em>Comparison type</em>
<ul>
<li>How do we compare the two predicted outcomes?</li>
<li>Ex: difference, ratio, log odds, lift, etc.</li>
</ul>
</li>
<li>Outcome type
<ul>
<li>What is the scale of the response variable?</li>
<li>Ex: response, link, hazard, etc.</li>
</ul>
</li>
</ul>
<p>By default, the <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> function will estimate the “effect” of different changes for different types of predictors:</p>
<ul>
<li>Numeric: Increase of 1 unit.</li>
<li>Logical: Change from <code>FALSE</code> to <code>TRUE</code>.</li>
<li>Factor or character: Changes from the reference to each other level.</li>
</ul>
<p>In this vignette, we will illustrate these concepts by studying variations on this question:</p>
<blockquote class="blockquote">
<p>How does the probability of survival (outcome) change if a passenger travels in 1st class vs.&nbsp;3rd class?</p>
</blockquote>
<p>Here, we download data about the Titanic from the <a href="https://vincentarelbundock.github.io/Rdatasets/articles/data.html">Rdatasets archive</a>, and fit a logistic regression model with passenger survival as outcome variable:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marginaleffects.com/">marginaleffects</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="st">"https://vincentarelbundock.github.io/Rdatasets/csv/Stat2Data/Titanic.csv"</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">dat</span>, na.strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"*"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Survived</span> <span class="op">~</span> <span class="va">PClass</span> <span class="op">*</span> <span class="va">SexCode</span> <span class="op">*</span> <span class="va">Age</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = Survived ~ PClass * SexCode * Age, family = binomial, </span></span>
<span><span class="co">#&gt;     data = dat)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                        Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)            1.505028   0.611076   2.463 0.013781 *  </span></span>
<span><span class="co">#&gt; PClass2nd              0.223573   0.944492   0.237 0.812880    </span></span>
<span><span class="co">#&gt; PClass3rd             -2.010027   0.791079  -2.541 0.011058 *  </span></span>
<span><span class="co">#&gt; SexCode                1.005486   1.333850   0.754 0.450956    </span></span>
<span><span class="co">#&gt; Age                   -0.054245   0.015029  -3.609 0.000307 ***</span></span>
<span><span class="co">#&gt; PClass2nd:SexCode      0.145764   1.771346   0.082 0.934416    </span></span>
<span><span class="co">#&gt; PClass3rd:SexCode     -0.681501   1.487329  -0.458 0.646806    </span></span>
<span><span class="co">#&gt; PClass2nd:Age         -0.089628   0.035118  -2.552 0.010705 *  </span></span>
<span><span class="co">#&gt; PClass3rd:Age          0.003595   0.025174   0.143 0.886434    </span></span>
<span><span class="co">#&gt; SexCode:Age            0.066404   0.034396   1.931 0.053531 .  </span></span>
<span><span class="co">#&gt; PClass2nd:SexCode:Age  0.047776   0.054344   0.879 0.379325    </span></span>
<span><span class="co">#&gt; PClass3rd:SexCode:Age -0.016443   0.043162  -0.381 0.703224    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 1025.57  on 755  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance:  639.64  on 744  degrees of freedom</span></span>
<span><span class="co">#&gt;   (557 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; AIC: 663.64</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These coefficient estimates are interesting, but difficult to interpret. In many applications, analysts will want to call the <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> or <code><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons()</a></code> functions to report more meaningful quantities of interest. The rest of explains in detail how to interpret and customize calls like this one:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term              Contrast Estimate Std. Error     z Pr(&gt;|z|)     S    2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;  Age     mean(+1)              -0.00598    0.00109 -5.51   &lt;0.001  24.7 -0.00811 -0.00386</span></span>
<span><span class="co">#&gt;  PClass  mean(2nd) - mean(1st) -0.22484    0.04054 -5.55   &lt;0.001  25.0 -0.30429 -0.14539</span></span>
<span><span class="co">#&gt;  PClass  mean(3rd) - mean(1st) -0.39568    0.04253 -9.30   &lt;0.001  66.0 -0.47904 -0.31231</span></span>
<span><span class="co">#&gt;  SexCode mean(1) - mean(0)      0.49731    0.03017 16.48   &lt;0.001 200.3  0.43816  0.55645</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="comparison-type" class="level2"><h2 class="anchored" data-anchor-id="comparison-type">Comparison type</h2>
<p>The default comparison type in <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> is the “difference”, which means that the <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> function will typically produce quantities which are often interpreted as a measure of “effect” in applications: risk differences, average treatment effects, G-computation estimates, etc. But <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> is not limited to differences, Indeed, it allows analysts to call on many built-in functions for comparison, and also to supply their own.</p>
<section id="differences" class="level3"><h3 class="anchored" data-anchor-id="differences">Differences</h3>
<p>By default, the <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> function will compare the predicted values by differencing (subtraction). For example, consider a hypothetical Titanic passenger with these characteristics:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">passenger</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    PClass <span class="op">=</span> <span class="st">"3rd"</span>,</span>
<span>    Age <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    SexCode <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What would happen to the predicted probability of survival if we were to increase the <code>SexCode</code> from 0 to 1? Or increase <code>Age</code> by 1 unit? Or change <code>PClass</code> from “3rd” to “1st”? To answer these questions, we could proceed manually by computing two predictions and then subtracting one from the other:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">passenger_0</span> <span class="op">&lt;-</span> <span class="va">passenger</span></span>
<span><span class="va">passenger_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span><span class="va">passenger</span>, SexCode <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prediction_0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">passenger_0</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">prediction_1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">passenger_1</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prediction_1</span> <span class="op">-</span> <span class="va">prediction_0</span></span>
<span><span class="co">#&gt;         1 </span></span>
<span><span class="co">#&gt; 0.2716978</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The result above shows that modifying the <code>SexCode</code> variable of this hypothetical passenger from 0 to 1 increases the predicted probability of survival by about 27 percentage points.</p>
<p>Instead of computing this estimate by hand, we could call <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> to get analogous results for all predictors in the model at once:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term  Contrast Estimate Std. Error     z Pr(&gt;|z|)    S   2.5 %    97.5 % PClass Age SexCode</span></span>
<span><span class="co">#&gt;  Age     +1        -0.00735     0.0033 -2.23   0.0258  5.3 -0.0138 -0.000887    3rd  20       0</span></span>
<span><span class="co">#&gt;  PClass  2nd - 1st -0.36282     0.0976 -3.72   &lt;0.001 12.3 -0.5541 -0.171567    3rd  20       0</span></span>
<span><span class="co">#&gt;  PClass  3rd - 1st -0.42376     0.0871 -4.87   &lt;0.001 19.7 -0.5945 -0.253040    3rd  20       0</span></span>
<span><span class="co">#&gt;  SexCode 1 - 0      0.27170     0.0588  4.62   &lt;0.001 18.0  0.1565  0.386927    3rd  20       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="ratios" class="level3"><h3 class="anchored" data-anchor-id="ratios">Ratios</h3>
<p>Instead of taking simple differences between adjusted predictions, it can sometimes be useful to compute ratios or other functions of predictions. For example, <a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1301300304">the <code>adjrr</code> function the <code>Stata</code> software package</a> can compute “adjusted risk ratios”, which are ratios of adjusted predictions. To do this in <code>R</code>, we could use the same predictions we computed above:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prediction_1</span> <span class="op">/</span> <span class="va">prediction_0</span></span>
<span><span class="co">#&gt;        1 </span></span>
<span><span class="co">#&gt; 2.511484</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This shows that the predicted probability of survival would be about 2.5% larger if our hypothetical passenger were a woman than a man.</p>
<p>The same result can be obtained by setting the <code>comparison</code> argument:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, comparison <span class="op">=</span> <span class="st">"ratio"</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term  Contrast Estimate Std. Error     z Pr(&gt;|z|)    S 2.5 % 97.5 % PClass Age SexCode</span></span>
<span><span class="co">#&gt;  Age     +1           0.959     0.0157 61.20   &lt;0.001  Inf 0.928  0.990    3rd  20       0</span></span>
<span><span class="co">#&gt;  PClass  2nd / 1st    0.399     0.1035  3.85   &lt;0.001 13.1 0.196  0.602    3rd  20       0</span></span>
<span><span class="co">#&gt;  PClass  3rd / 1st    0.298     0.0640  4.65   &lt;0.001 18.2 0.172  0.423    3rd  20       0</span></span>
<span><span class="co">#&gt;  SexCode 1 / 0        2.511     0.5048  4.97   &lt;0.001 20.5 1.522  3.501    3rd  20       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="built-in-functions" class="level3"><h3 class="anchored" data-anchor-id="built-in-functions">Built-in functions</h3>
<p>Beyond differences and ratios, <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> supports many other built-in functions to compare predictions, such as log odds ratios, lift, etc. See <code><a href="https://marginaleffects.com/man/comparisons.html">?comparisons</a></code> for a complete list.</p>
<p>These built-in functions allow us convenient access to complex transformations. For example, this code computes the log odds ratio associated with a change in predictors:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, </span>
<span>    comparison <span class="op">=</span> <span class="st">"lnor"</span>, </span>
<span>    newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term                  Contrast Estimate Std. Error     z Pr(&gt;|z|)    S   2.5 %  97.5 % PClass Age SexCode</span></span>
<span><span class="co">#&gt;  Age     +1                         -0.0507     0.0202 -2.51   0.0121  6.4 -0.0902 -0.0111    3rd  20       0</span></span>
<span><span class="co">#&gt;  PClass  ln(odds(2nd) / odds(1st))  -1.5690     0.4491 -3.49   &lt;0.001 11.0 -2.4491 -0.6888    3rd  20       0</span></span>
<span><span class="co">#&gt;  PClass  ln(odds(3rd) / odds(1st))  -1.9381     0.3977 -4.87   &lt;0.001 19.8 -2.7177 -1.1586    3rd  20       0</span></span>
<span><span class="co">#&gt;  SexCode ln(odds(1) / odds(0))       1.3232     0.2883  4.59   &lt;0.001 17.8  0.7582  1.8882    3rd  20       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="custom-functions" class="level3"><h3 class="anchored" data-anchor-id="custom-functions">Custom functions</h3>
<p>Analysts who need more flexibility can define their own comparison functions. For example, these two calls are equivalent:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, </span>
<span>    comparison <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">hi</span>, <span class="va">lo</span><span class="op">)</span> <span class="va">hi</span> <span class="op">/</span> <span class="va">lo</span>, </span>
<span>    newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term Contrast Estimate Std. Error     z Pr(&gt;|z|)    S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  Age     +1          0.959     0.0157 61.20   &lt;0.001  Inf 0.928  0.990</span></span>
<span><span class="co">#&gt;  PClass  2nd, 1st    0.399     0.1035  3.85   &lt;0.001 13.1 0.196  0.602</span></span>
<span><span class="co">#&gt;  PClass  3rd, 1st    0.298     0.0640  4.65   &lt;0.001 18.2 0.172  0.423</span></span>
<span><span class="co">#&gt;  SexCode 1, 0        2.511     0.5048  4.97   &lt;0.001 20.5 1.522  3.501</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, </span>
<span>    comparison <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">hi</span>, <span class="va">lo</span><span class="op">)</span> <span class="va">hi</span> <span class="op">/</span> <span class="va">lo</span>, </span>
<span>    newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term Contrast Estimate Std. Error     z Pr(&gt;|z|)    S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  Age     +1          0.959     0.0157 61.20   &lt;0.001  Inf 0.928  0.990</span></span>
<span><span class="co">#&gt;  PClass  2nd, 1st    0.399     0.1035  3.85   &lt;0.001 13.1 0.196  0.602</span></span>
<span><span class="co">#&gt;  PClass  3rd, 1st    0.298     0.0640  4.65   &lt;0.001 18.2 0.172  0.423</span></span>
<span><span class="co">#&gt;  SexCode 1, 0        2.511     0.5048  4.97   &lt;0.001 20.5 1.522  3.501</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This mechanism is powerful, because it lets users create fully customized contrasts. Here is a non-sensical example:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>    comparison <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">hi</span>, <span class="va">lo</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">hi</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">lo</span> <span class="op">+</span> <span class="fl">10</span><span class="op">)</span>, </span>
<span>    newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term Contrast Estimate Std. Error     z Pr(&gt;|z|)     S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  Age     +1          0.179     0.0145 12.36   &lt;0.001 114.2 0.151  0.207</span></span>
<span><span class="co">#&gt;  PClass  2nd, 1st    0.208     0.0230  9.04   &lt;0.001  62.4 0.163  0.253</span></span>
<span><span class="co">#&gt;  PClass  3rd, 1st    0.180     0.0150 11.97   &lt;0.001 107.3 0.150  0.209</span></span>
<span><span class="co">#&gt;  SexCode 1, 0        0.290     0.0162 17.85   &lt;0.001 234.4 0.258  0.321</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="predictor-types" class="level2"><h2 class="anchored" data-anchor-id="predictor-types">Predictor types</h2>
<p>The types of comparisons that one might care about depend on the kinds of predictors in our model: numeric, binary, or categorical.</p>
<section id="numeric" class="level3"><h3 class="anchored" data-anchor-id="numeric">Numeric</h3>
<p>We can also compute contrasts for differences in numeric variables. For example, we can see what happens to the adjusted predictions when we increment the <code>Age</code> variable by 1 unit (default) or by 5 units:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="st">"Age"</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)   S   2.5 %    97.5 % PClass SexCode</span></span>
<span><span class="co">#&gt;  -0.00735     0.0033 -2.23   0.0258 5.3 -0.0138 -0.000887    3rd       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: Age</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: +1</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)   S   2.5 %   97.5 % PClass SexCode</span></span>
<span><span class="co">#&gt;   -0.0344     0.0146 -2.35   0.0188 5.7 -0.0631 -0.00569    3rd       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: Age</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: +5</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compare adjusted predictions for a change in the regressor between two arbitrary values:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)   S  2.5 %  97.5 % PClass SexCode</span></span>
<span><span class="co">#&gt;    -0.291      0.106 -2.75  0.00595 7.4 -0.498 -0.0836    3rd       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: Age</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: 60 - 5</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compare adjusted predictions when the regressor changes across the interquartile range, across one or two standard deviations about its mean, or from across its full range:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="st">"iqr"</span><span class="op">)</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)   S  2.5 %  97.5 % PClass SexCode</span></span>
<span><span class="co">#&gt;   -0.0952     0.0319 -2.98  0.00284 8.5 -0.158 -0.0327    3rd       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: Age</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: Q3 - Q1</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="st">"sd"</span><span class="op">)</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)   S  2.5 %  97.5 % PClass SexCode</span></span>
<span><span class="co">#&gt;   -0.0739     0.0241 -3.07  0.00217 8.8 -0.121 -0.0267    3rd       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: Age</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: (x + sd/2) - (x - sd/2)</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="st">"2sd"</span><span class="op">)</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)   S  2.5 %  97.5 % PClass SexCode</span></span>
<span><span class="co">#&gt;    -0.151     0.0519 -2.92  0.00355 8.1 -0.253 -0.0496    3rd       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: Age</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: (x + sd) - (x - sd)</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="st">"minmax"</span><span class="op">)</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)   S  2.5 % 97.5 % PClass SexCode</span></span>
<span><span class="co">#&gt;    -0.358       0.13 -2.75  0.00601 7.4 -0.614 -0.103    3rd       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: Age</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: Max - Min</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="binary-or-logical" class="level3"><h3 class="anchored" data-anchor-id="binary-or-logical">Binary or Logical</h3>
<p>For logical or binary variables, the default comparison correponds to a change from 0 to 1, or from <code>FALSE</code> to <code>TRUE</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span><span class="va">dat</span>, SexCode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html">as.logical</a></span><span class="op">(</span><span class="va">SexCode</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Survived</span> <span class="op">~</span> <span class="va">PClass</span> <span class="op">*</span> <span class="va">SexCode</span> <span class="op">*</span> <span class="va">Age</span>, data <span class="op">=</span> <span class="va">dat2</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="st">"SexCode"</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|)    S 2.5 % 97.5 % PClass Age</span></span>
<span><span class="co">#&gt;     0.272     0.0588 4.62   &lt;0.001 18.0 0.156  0.387    3rd  20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: SexCode</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: 1 - 0</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod2</span>, variables <span class="op">=</span> <span class="st">"SexCode"</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|)    S 2.5 % 97.5 % PClass Age</span></span>
<span><span class="co">#&gt;     0.272     0.0588 4.62   &lt;0.001 18.0 0.156  0.387    3rd  20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: SexCode</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: TRUE - FALSE</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="factor-or-character" class="level3"><h3 class="anchored" data-anchor-id="factor-or-character">Factor or Character</h3>
<p>The <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> function automatically computes contrasts for each level of a categorical variable (factor or character), relative to the baseline category, while holding all other values at their observed values. We can obtain different contrasts by using the <code>variables</code> argument:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="st">"sequential"</span><span class="op">)</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Contrast Estimate Std. Error      z Pr(&gt;|z|)    S  2.5 %  97.5 % Age SexCode</span></span>
<span><span class="co">#&gt;  2nd - 1st  -0.3628     0.0976 -3.718   &lt;0.001 12.3 -0.554 -0.1716  20       0</span></span>
<span><span class="co">#&gt;  3rd - 2nd  -0.0609     0.0611 -0.997    0.319  1.6 -0.181  0.0589  20       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: PClass</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="st">"pairwise"</span><span class="op">)</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Contrast Estimate Std. Error      z Pr(&gt;|z|)    S  2.5 %  97.5 % Age SexCode</span></span>
<span><span class="co">#&gt;  2nd - 1st  -0.3628     0.0976 -3.718   &lt;0.001 12.3 -0.554 -0.1716  20       0</span></span>
<span><span class="co">#&gt;  3rd - 1st  -0.4238     0.0871 -4.865   &lt;0.001 19.7 -0.594 -0.2530  20       0</span></span>
<span><span class="co">#&gt;  3rd - 2nd  -0.0609     0.0611 -0.997    0.319  1.6 -0.181  0.0589  20       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: PClass</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="st">"reference"</span><span class="op">)</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Contrast Estimate Std. Error     z Pr(&gt;|z|)    S  2.5 % 97.5 % Age SexCode</span></span>
<span><span class="co">#&gt;  2nd - 1st   -0.363     0.0976 -3.72   &lt;0.001 12.3 -0.554 -0.172  20       0</span></span>
<span><span class="co">#&gt;  3rd - 1st   -0.424     0.0871 -4.87   &lt;0.001 19.7 -0.594 -0.253  20       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: PClass</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also specify a particular contrast of interest in <code>variables</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, </span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"3rd"</span>, <span class="st">"1st"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|)    S 2.5 % 97.5 % Age SexCode</span></span>
<span><span class="co">#&gt;     0.424     0.0871 4.87   &lt;0.001 19.7 0.253  0.594  20       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: PClass</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: 1st - 3rd</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="cross-contrasts" class="level3"><h3 class="anchored" data-anchor-id="cross-contrasts">Cross-contrasts</h3>
<p>In other contexts, we are interested in a “cross-contrast” or “cross-comparisons”, that is, we would like to know what happens when two (or more) predictors change at the same time. To assess this, we can specify the regressors of interest in the <code>variables</code> argument, and set the <code>cross=TRUE</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, </span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>SexCode <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, Age <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    cross <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="va">cmp</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  C: Age C: SexCode Estimate Std. Error    z Pr(&gt;|z|)    S 2.5 % 97.5 % PClass Age SexCode</span></span>
<span><span class="co">#&gt;      +5      1 - 0    0.271     0.0584 4.64   &lt;0.001 18.1 0.156  0.385    3rd  20       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast_Age, contrast_SexCode, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, Survived, SexCode</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This tells us that changing our hypothetical passenger from <code>SexCode=0</code> to 1, and from <code>Age=20</code> to 25 <em>simultaneously</em> is associated with a change of 0.27 in the predicted probability of survival (on a 0 to 1 scale).</p>
</section></section><section id="outcome-type" class="level2"><h2 class="anchored" data-anchor-id="outcome-type">Outcome type</h2>
<p>We can compute contrasts on different response scales. In GLM model, for example, we tend to estimate contrasts and comparisons on the “response” scale, becasue the results are expressed on the natural unit of measurement of the dependent variable. However, we an also compute the quantity on the “link” scale, by changing the <code>type</code> argument:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"response"</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term  Contrast Estimate Std. Error     z Pr(&gt;|z|)    S   2.5 %    97.5 % PClass Age SexCode</span></span>
<span><span class="co">#&gt;  Age     +1        -0.00735     0.0033 -2.23   0.0258  5.3 -0.0138 -0.000887    3rd  20       0</span></span>
<span><span class="co">#&gt;  PClass  2nd - 1st -0.36282     0.0976 -3.72   &lt;0.001 12.3 -0.5541 -0.171567    3rd  20       0</span></span>
<span><span class="co">#&gt;  PClass  3rd - 1st -0.42376     0.0871 -4.87   &lt;0.001 19.7 -0.5945 -0.253040    3rd  20       0</span></span>
<span><span class="co">#&gt;  SexCode 1 - 0      0.27170     0.0588  4.62   &lt;0.001 18.0  0.1565  0.386927    3rd  20       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"link"</span>, newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term  Contrast Estimate Std. Error     z Pr(&gt;|z|)    S   2.5 %  97.5 % PClass Age SexCode</span></span>
<span><span class="co">#&gt;  Age     +1         -0.0507     0.0202 -2.51   0.0121  6.4 -0.0902 -0.0111    3rd  20       0</span></span>
<span><span class="co">#&gt;  PClass  2nd - 1st  -1.5690     0.4491 -3.49   &lt;0.001 11.0 -2.4491 -0.6888    3rd  20       0</span></span>
<span><span class="co">#&gt;  PClass  3rd - 1st  -1.9381     0.3977 -4.87   &lt;0.001 19.8 -2.7177 -1.1586    3rd  20       0</span></span>
<span><span class="co">#&gt;  SexCode 1 - 0       1.3232     0.2883  4.59   &lt;0.001 17.8  0.7582  1.8882    3rd  20       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  link </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The support <code>type</code> values depend on the kind of fitted model at hand. Supported types for a specific model are printed to screen when a bad type is entered:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"bad type name"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in sanitize_type(model = model, type = type, calling_function = "comparisons"): Assertion on 'type' failed: Must be element of set {'response','link'}, but is 'bad type name'.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="grid" class="level1"><h1>Grid</h1>
<p>In most statistical models, comparisons (differences, ratios, etc.) are <em>conditional</em> quantities, in the sense that they typically depend on the values of all the predictors in the model. Therefore, when we compute a comparison, we need to decide <em>where</em> to evaluate it in the predictor space.</p>
<p>A “profile” is a combination of values of the predictor variables in a model. A “grid” is a collection of one or more profiles. You can think of a “grid” as different rows in a dataset, where each row contains the information necessary to predict the outcome for one individual or unit of observation.</p>
<p>A “profile” can be defined as a specific combination of predictor values, and a “grid” can be defined as a collection of profiles for which we can evaluate quantities of interest.</p>
<p>There are many possible grids:</p>
<ul>
<li>Empirical distribution</li>
<li>User-specified values</li>
<li>Representative values</li>
</ul>
<section id="empirical-distribution" class="level2"><h2 class="anchored" data-anchor-id="empirical-distribution">Empirical distribution</h2>
<p>By default, the <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> function returns estimates for every single row of the original data frame which was used to fit the model. The Titanic dataset includes 756 complete observations (after dropping missing data), so this command will yield 756 estimates:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="st">"Age"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Estimate Std. Error      z Pr(&gt;|z|)    S    2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;   0.000618    0.00169  0.365  0.71479  0.5 -0.00270  0.00393</span></span>
<span><span class="co">#&gt;   0.000823    0.00283  0.291  0.77092  0.4 -0.00472  0.00636</span></span>
<span><span class="co">#&gt;  -0.013485    0.00386 -3.493  &lt; 0.001 11.0 -0.02105 -0.00592</span></span>
<span><span class="co">#&gt;   0.000645    0.00183  0.352  0.72511  0.5 -0.00295  0.00424</span></span>
<span><span class="co">#&gt;  -0.008463    0.00117 -7.217  &lt; 0.001 40.8 -0.01076 -0.00616</span></span>
<span><span class="co">#&gt; --- 746 rows omitted. See ?avg_comparisons and ?print.marginaleffects --- </span></span>
<span><span class="co">#&gt;  -0.005742    0.00207 -2.774  0.00554 7.5 -0.00980 -0.00168</span></span>
<span><span class="co">#&gt;  -0.005959    0.00223 -2.673  0.00753 7.1 -0.01033 -0.00159</span></span>
<span><span class="co">#&gt;  -0.006871    0.00292 -2.350  0.01877 5.7 -0.01260 -0.00114</span></span>
<span><span class="co">#&gt;  -0.006407    0.00257 -2.496  0.01255 6.3 -0.01144 -0.00138</span></span>
<span><span class="co">#&gt;  -0.005321    0.00177 -3.006  0.00264 8.6 -0.00879 -0.00185</span></span>
<span><span class="co">#&gt; Term: Age</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: +1</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, Survived, PClass, SexCode, Age</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we do not specify the <code>variables</code> argument, <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> computes 4 distinct contrasts for all the variables, so we get <span class="math inline">\(4\\times 756=3024\)</span> rows:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term Contrast  Estimate Std. Error      z Pr(&gt;|z|)    S    2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;  Age        +1     0.000618    0.00169  0.365    0.715  0.5 -0.00270  0.00393</span></span>
<span><span class="co">#&gt;  Age        +1     0.000823    0.00283  0.291    0.771  0.4 -0.00472  0.00636</span></span>
<span><span class="co">#&gt;  Age        +1    -0.013485    0.00386 -3.493   &lt;0.001 11.0 -0.02105 -0.00592</span></span>
<span><span class="co">#&gt;  Age        +1     0.000645    0.00183  0.352    0.725  0.5 -0.00295  0.00424</span></span>
<span><span class="co">#&gt;  Age        +1    -0.008463    0.00117 -7.217   &lt;0.001 40.8 -0.01076 -0.00616</span></span>
<span><span class="co">#&gt; --- 3014 rows omitted. See ?avg_comparisons and ?print.marginaleffects --- </span></span>
<span><span class="co">#&gt;  SexCode    1 - 0  0.317013    0.05762  5.501   &lt;0.001 24.7  0.20407  0.42995</span></span>
<span><span class="co">#&gt;  SexCode    1 - 0  0.311224    0.05657  5.502   &lt;0.001 24.7  0.20035  0.42210</span></span>
<span><span class="co">#&gt;  SexCode    1 - 0  0.285811    0.05627  5.080   &lt;0.001 21.3  0.17553  0.39609</span></span>
<span><span class="co">#&gt;  SexCode    1 - 0  0.298977    0.05557  5.380   &lt;0.001 23.7  0.19005  0.40790</span></span>
<span><span class="co">#&gt;  SexCode    1 - 0  0.327942    0.06066  5.406   &lt;0.001 23.9  0.20905  0.44684</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, Survived, PClass, SexCode, Age</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can plot the full distribution of unit-specific contrasts easily:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">term</span> <span class="op">+</span> <span class="va">contrast</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="comparisons_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The plot above suggests that there is substantial heterogeneity in treatment effects across different unit characteristics.</p>
</section><section id="user-specified-values" class="level2"><h2 class="anchored" data-anchor-id="user-specified-values">User-specified values</h2>
<p>In some contexts, it is interesting to estimate a contrast for a specific individual with characteristics of interest. To achieve this, we can supply a data frame to the <code>newdata</code> argument.</p>
<p>This code shows the expected change in probability of survival in the counterfactual world where Mr Harry Anderson had been 20 years older:</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">unit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">Name</span> <span class="op">==</span> <span class="st">"Anderson, Mr Harry"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">unit</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term  Contrast Estimate Std. Error     z Pr(&gt;|z|)     S  2.5 %   97.5 % rownames               Name PClass Age  Sex SexCode</span></span>
<span><span class="co">#&gt;  Age     +1         -0.0103    0.00239 -4.31   &lt;0.001  15.9 -0.015 -0.00562        6 Anderson, Mr Harry    1st  47 male       0</span></span>
<span><span class="co">#&gt;  PClass  2nd - 1st  -0.2538    0.04630 -5.48   &lt;0.001  24.5 -0.345 -0.16307        6 Anderson, Mr Harry    1st  47 male       0</span></span>
<span><span class="co">#&gt;  PClass  3rd - 1st  -0.2074    0.05290 -3.92   &lt;0.001  13.5 -0.311 -0.10372        6 Anderson, Mr Harry    1st  47 male       0</span></span>
<span><span class="co">#&gt;  SexCode 1 - 0       0.6959    0.05207 13.37   &lt;0.001 132.9  0.594  0.79791        6 Anderson, Mr Harry    1st  47 male       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, rownames, Name, PClass, Age, Sex, Survived, SexCode</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A very convenient way to create grids of units with specific predictor values is to the <code><a href="https://marginaleffects.com/man/datagrid.html">datagrid()</a></code> function from the <code>marginaleffects</code> package. With this function, we can specify exactly where we want to evaluate the comparison in the predictor space. Say we are interested in:</p>
<blockquote class="blockquote">
<p>The effect of changing passenger class on the predicted probability of survival for a 50 year old man and a 50 year old woman.</p>
</blockquote>
<p>We can type:</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"PClass"</span>, </span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">50</span>, SexCode <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Contrast Age SexCode Estimate Std. Error     z Pr(&gt;|z|)    S  2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;  2nd - 1st  50       0   -0.226     0.0473 -4.78   &lt;0.001 19.1 -0.319 -0.1333</span></span>
<span><span class="co">#&gt;  2nd - 1st  50       1   -0.156     0.1034 -1.51    0.131  2.9 -0.359  0.0465</span></span>
<span><span class="co">#&gt;  3rd - 1st  50       0   -0.184     0.0535 -3.45   &lt;0.001 10.8 -0.289 -0.0796</span></span>
<span><span class="co">#&gt;  3rd - 1st  50       1   -0.511     0.1242 -4.12   &lt;0.001 14.7 -0.755 -0.2679</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: PClass</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, Age, SexCode, predicted_lo, predicted_hi, predicted, PClass, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that the contrasts are different for the man and the woman. It appears that changing class has a larger effect on the expected probability of survival for men than for women.</p>
<p>Note that when using <code><a href="https://marginaleffects.com/man/datagrid.html">datagrid()</a></code> in this manner, variables that are not specified explicitly by the user are held at their mean or mode.</p>
</section><section id="representative-values" class="level2"><h2 class="anchored" data-anchor-id="representative-values">Representative values</h2>
<p>An alternative which used to be very common but has now fallen into a bit of disfavor is to compute “Contrasts at the mean.” The idea is to create a “representative” or “synthetic” individual (row of the dataset) whose characteristics are completely average (or modal). Then, we compute and report the contrast for this specific hypothetical individual. For example:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term  Contrast Estimate Std. Error     z Pr(&gt;|z|)    S    2.5 %   97.5 % PClass SexCode  Age</span></span>
<span><span class="co">#&gt;  Age     +1        -0.00504    0.00158 -3.20  0.00139  9.5 -0.00813 -0.00195    3rd       0 30.4</span></span>
<span><span class="co">#&gt;  PClass  2nd - 1st -0.39777    0.06378 -6.24  &lt; 0.001 31.1 -0.52278 -0.27277    3rd       0 30.4</span></span>
<span><span class="co">#&gt;  PClass  3rd - 1st -0.34949    0.06333 -5.52  &lt; 0.001 24.8 -0.47361 -0.22537    3rd       0 30.4</span></span>
<span><span class="co">#&gt;  SexCode 1 - 0      0.33509    0.06340  5.29  &lt; 0.001 22.9  0.21083  0.45935    3rd       0 30.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, SexCode, Age, Survived</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term  Contrast Estimate Std. Error     z Pr(&gt;|z|)    S    2.5 %   97.5 % PClass SexCode  Age</span></span>
<span><span class="co">#&gt;  Age     +1        -0.00504    0.00158 -3.20  0.00139  9.5 -0.00813 -0.00195    3rd       0 30.4</span></span>
<span><span class="co">#&gt;  PClass  2nd - 1st -0.39777    0.06378 -6.24  &lt; 0.001 31.1 -0.52278 -0.27277    3rd       0 30.4</span></span>
<span><span class="co">#&gt;  PClass  3rd - 1st -0.34949    0.06333 -5.52  &lt; 0.001 24.8 -0.47361 -0.22537    3rd       0 30.4</span></span>
<span><span class="co">#&gt;  SexCode 1 - 0      0.33509    0.06340  5.29  &lt; 0.001 22.9  0.21083  0.45935    3rd       0 30.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, SexCode, Age, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Contrasts at the mean can differ substantially from average contrasts.</p>
<p>The advantage of this approach is that it is very cheap and fast computationally. The disadvantage is that the interpretation is somewhat ambiguous. Often times, there simply does not exist an individual who is perfectly average across all dimensions of the dataset. It is also not clear why the analyst should be particularly interested in the contrast for this one, synthetic, perfectly average individual.</p>
</section><section id="balanced-grids" class="level2"><h2 class="anchored" data-anchor-id="balanced-grids">Balanced grids</h2>
<p>One type of grid which may be particularly useful in experimental setting is the “balanced grid”, which includes all unique combinations of categorical variables, while holding numeric variables a their means. For example, in the Titanic dataset there are two categorical variables, <code>SexCode</code> and <code>PClass</code>, with 2 and 3 categories respectively. A balanced grid, will thus have rows. We can create this grid with:</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>, grid_type <span class="op">=</span> <span class="st">"balanced"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   PClass SexCode      Age rowid</span></span>
<span><span class="co">#&gt; 1    1st       1 30.39799     1</span></span>
<span><span class="co">#&gt; 2    1st       0 30.39799     2</span></span>
<span><span class="co">#&gt; 3    2nd       1 30.39799     3</span></span>
<span><span class="co">#&gt; 4    2nd       0 30.39799     4</span></span>
<span><span class="co">#&gt; 5    3rd       1 30.39799     5</span></span>
<span><span class="co">#&gt; 6    3rd       0 30.39799     6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When using <code><a href="https://marginaleffects.com/man/datagrid.html">datagrid()</a></code> inside a <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> call, we do not need to specify the <code>model</code> argument manually:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>    variables <span class="op">=</span> <span class="st">"SexCode"</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>grid_type <span class="op">=</span> <span class="st">"balanced"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)     S 2.5 % 97.5 % PClass  Age</span></span>
<span><span class="co">#&gt;     0.483     0.0631  7.65   &lt;0.001  45.5 0.359  0.606    1st 30.4</span></span>
<span><span class="co">#&gt;     0.483     0.0631  7.65   &lt;0.001  45.5 0.359  0.606    1st 30.4</span></span>
<span><span class="co">#&gt;     0.812     0.0447 18.18   &lt;0.001 243.0 0.725  0.900    2nd 30.4</span></span>
<span><span class="co">#&gt;     0.812     0.0447 18.18   &lt;0.001 243.0 0.725  0.900    2nd 30.4</span></span>
<span><span class="co">#&gt;     0.335     0.0634  5.29   &lt;0.001  22.9 0.211  0.459    3rd 30.4</span></span>
<span><span class="co">#&gt;     0.335     0.0634  5.29   &lt;0.001  22.9 0.211  0.459    3rd 30.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: SexCode</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: 1 - 0</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, SexCode, Age, Survived</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>    variables <span class="op">=</span> <span class="st">"SexCode"</span>,</span>
<span>    newdata <span class="op">=</span> <span class="st">"balanced"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)     S 2.5 % 97.5 % PClass  Age</span></span>
<span><span class="co">#&gt;     0.483     0.0631  7.65   &lt;0.001  45.5 0.359  0.606    1st 30.4</span></span>
<span><span class="co">#&gt;     0.483     0.0631  7.65   &lt;0.001  45.5 0.359  0.606    1st 30.4</span></span>
<span><span class="co">#&gt;     0.812     0.0447 18.18   &lt;0.001 243.0 0.725  0.900    2nd 30.4</span></span>
<span><span class="co">#&gt;     0.812     0.0447 18.18   &lt;0.001 243.0 0.725  0.900    2nd 30.4</span></span>
<span><span class="co">#&gt;     0.335     0.0634  5.29   &lt;0.001  22.9 0.211  0.459    3rd 30.4</span></span>
<span><span class="co">#&gt;     0.335     0.0634  5.29   &lt;0.001  22.9 0.211  0.459    3rd 30.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: SexCode</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: 1 - 0</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, SexCode, Age, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="aggregation" class="level1"><h1>Aggregation</h1>
<p>As discussed above, the default behavior of <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> is to estimate quantities of interest for all the actually observed units in our dataset. Sometimes, it is convenient to marginalize those conditional estimates, in order to obtain an “average contrast”. The procedure is as follows:</p>
<ol type="1">
<li>Compute estimates for each row of the original dataset.</li>
<li>Average the estimates across the whole dataset, or within subgroups.</li>
</ol>
<p>To average estimates, we call the same function as before, with the previx <code>avg_</code>, and possibly with the <code>by</code> argument:</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term              Contrast Estimate Std. Error     z Pr(&gt;|z|)     S    2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;  Age     mean(+1)              -0.00598    0.00109 -5.51   &lt;0.001  24.7 -0.00811 -0.00386</span></span>
<span><span class="co">#&gt;  PClass  mean(2nd) - mean(1st) -0.22484    0.04054 -5.55   &lt;0.001  25.0 -0.30429 -0.14539</span></span>
<span><span class="co">#&gt;  PClass  mean(3rd) - mean(1st) -0.39568    0.04253 -9.30   &lt;0.001  66.0 -0.47904 -0.31231</span></span>
<span><span class="co">#&gt;  SexCode mean(1) - mean(0)      0.49731    0.03017 16.48   &lt;0.001 200.3  0.43816  0.55645</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is equivalent to:</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">cmp</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="va">cmp</span><span class="op">$</span><span class="va">term</span> <span class="op">==</span> <span class="st">"Age"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.00598373</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">~</span> <span class="va">term</span> <span class="op">+</span> <span class="va">contrast</span>, data <span class="op">=</span> <span class="va">cmp</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt;      term  contrast    estimate</span></span>
<span><span class="co">#&gt; 1     Age        +1 -0.00598373</span></span>
<span><span class="co">#&gt; 2 SexCode     1 - 0  0.49730674</span></span>
<span><span class="co">#&gt; 3  PClass 2nd - 1st -0.22483577</span></span>
<span><span class="co">#&gt; 4  PClass 3rd - 1st -0.39567579</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="subgroups" class="level2"><h2 class="anchored" data-anchor-id="subgroups">Subgroups</h2>
<p>Using the <code>by</code> argument we can compute the “average effect” (i.e., “contrast” or “risk difference”) of an increase of 10 years of <code>Age</code> in each of the passenger classes:</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"PClass"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  PClass Estimate Std. Error     z Pr(&gt;|z|)    S   2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;     1st  -0.0524     0.0129 -4.08   &lt;0.001 14.4 -0.0776 -0.02725</span></span>
<span><span class="co">#&gt;     2nd  -0.0718     0.0164 -4.39   &lt;0.001 16.4 -0.1039 -0.03976</span></span>
<span><span class="co">#&gt;     3rd  -0.0359     0.0178 -2.02   0.0433  4.5 -0.0708 -0.00108</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: Age</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: mean(+10)</span></span>
<span><span class="co">#&gt; Columns: term, contrast, PClass, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="marginal-means" class="level2"><h2 class="anchored" data-anchor-id="marginal-means">Marginal means</h2>
<p>In experimental studies, it can often make sense to estimate contrasts, averaged across a balanced grid of treatment conditions:</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="st">"balanced"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term              Contrast Estimate Std. Error     z Pr(&gt;|z|)     S    2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;  Age     mean(+1)              -0.00494    0.00119 -4.14   &lt;0.001  14.8 -0.00728 -0.0026</span></span>
<span><span class="co">#&gt;  PClass  mean(2nd) - mean(1st) -0.23312    0.03865 -6.03   &lt;0.001  29.2 -0.30887 -0.1574</span></span>
<span><span class="co">#&gt;  PClass  mean(3rd) - mean(1st) -0.42333    0.04472 -9.47   &lt;0.001  68.2 -0.51098 -0.3357</span></span>
<span><span class="co">#&gt;  SexCode mean(1) - mean(0)      0.54331    0.03332 16.30   &lt;0.001 196.1  0.47800  0.6086</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the results are slightly different than when averaging across the empirical, because the number of actual passengers aboard the Titanic was not perfectly balanced across gender and ticket categories:</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term              Contrast Estimate Std. Error     z Pr(&gt;|z|)     S    2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;  Age     mean(+1)              -0.00598    0.00109 -5.51   &lt;0.001  24.7 -0.00811 -0.00386</span></span>
<span><span class="co">#&gt;  PClass  mean(2nd) - mean(1st) -0.22484    0.04054 -5.55   &lt;0.001  25.0 -0.30429 -0.14539</span></span>
<span><span class="co">#&gt;  PClass  mean(3rd) - mean(1st) -0.39568    0.04253 -9.30   &lt;0.001  66.0 -0.47904 -0.31231</span></span>
<span><span class="co">#&gt;  SexCode mean(1) - mean(0)      0.49731    0.03017 16.48   &lt;0.001 200.3  0.43816  0.55645</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="uncertainty" class="level1"><h1>Uncertainty</h1>
<p>By default, the standard errors around contrasts are computed using the delta method. This vignette offers extensive discussion and examples:</p>
<p><a href="https://marginaleffects.com/vignettes/uncertainty.html" class="uri">https://marginaleffects.com/vignettes/uncertainty.html</a></p>
<section id="robust-clustered-standard-errors" class="level2"><h2 class="anchored" data-anchor-id="robust-clustered-standard-errors">Robust (clustered) standard errors</h2>
<p>The standard errors reported by default for most models are “classical” (or “iid”). For models supported by the <code>sandwich</code> or <code>clubSandwich</code> packages, we can call on the <code>vcov</code> argument to report robust standard errors (and confidence intervales, p values, etc.):</p>
<p>Classical:</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="st">"SexCode"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|)     S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     0.497     0.0302 16.5   &lt;0.001 200.3 0.438  0.556</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: SexCode</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: mean(1) - mean(0)</span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Heteroskedasticity-robust:</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span>, vcov <span class="op">=</span> <span class="st">"HC3"</span>, variables <span class="op">=</span> <span class="st">"SexCode"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|)     S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     0.497     0.0306 16.2   &lt;0.001 194.7 0.437  0.557</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: SexCode</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: mean(1) - mean(0)</span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="bootstrap-and-simulation" class="level2"><h2 class="anchored" data-anchor-id="bootstrap-and-simulation">Bootstrap and simulation</h2>
<p>We can use bootstrapping or simulations to compute uncertainty estimates, via the <code><a href="https://marginaleffects.com/man/inferences.html">inferences()</a></code> function. Notice that, for some quantities, the classical intervals are very different (here: symmetric) than boostrap intervals (here: asymmetric):</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># classical</span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span>, comparison <span class="op">=</span> <span class="st">"lnor"</span>, variables <span class="op">=</span> <span class="st">"SexCode"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|)     S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;      2.19      0.159 13.8   &lt;0.001 141.7  1.88   2.51</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: SexCode</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: ln(odds(1) / odds(0))</span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span>
<span></span>
<span><span class="co"># bootstrap</span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span>, comparison <span class="op">=</span> <span class="st">"lnor"</span>, variables <span class="op">=</span> <span class="st">"SexCode"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://marginaleffects.com/man/inferences.html">inferences</a></span><span class="op">(</span><span class="st">"rsample"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;      2.19  1.87   2.53</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: SexCode</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: ln(odds(1) / odds(0))</span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, predicted_lo, predicted_hi, predicted, conf.low, conf.high</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="transformation" class="level2"><h2 class="anchored" data-anchor-id="transformation">Transformation</h2>
<p>By default, the standard errors around contrasts are computed on the scale determined by the <code>type</code> argument (e.g., “link” or “response”). Some analysts may prefer to proceed differently. For example, in <code>Stata</code>, the <code>adjrr</code> computes adjusted risk ratios (ARR) in two steps:</p>
<ol type="1">
<li>Compute the natural log of the ratio between the mean of adjusted predictions with <span class="math inline">\(x+1\)</span> and the mean of adjusted predictions with <span class="math inline">\(x\)</span>.</li>
<li>Exponentiate the estimate and confidence interval bounds.</li>
</ol>
<p>Step 1 is easy to achieve with the <code>comparison</code> argument described above. Step 2 can be achieved with the <code>transform</code> argument:</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    comparison <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">hi</span>, <span class="va">lo</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">hi</span> <span class="op">/</span> <span class="va">lo</span><span class="op">)</span>,</span>
<span>    transform <span class="op">=</span> <span class="va">exp</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term Contrast Estimate Pr(&gt;|z|)    S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  Age     +1          0.962   &lt;0.001 24.9 0.949  0.975</span></span>
<span><span class="co">#&gt;  PClass  2nd, 1st    0.267   &lt;0.001 19.6 0.157  0.456</span></span>
<span><span class="co">#&gt;  PClass  3rd, 1st    0.323   &lt;0.001 35.9 0.233  0.449</span></span>
<span><span class="co">#&gt;  SexCode 1, 0        4.506   &lt;0.001 86.6 3.421  5.934</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, p.value, s.value, conf.low, conf.high</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that we can use the <code>lnratioavg</code> shortcut instead of defining the function ourselves.</p>
<p>The order of operations in previous command was:</p>
<ol type="1">
<li>Compute the custom unit-level log ratios</li>
<li>Exponentiate them</li>
<li>Take the average using the <code><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons()</a></code>
</li>
</ol>
<p>There is a very subtle difference between the procedure above and this code:</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    comparison <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">hi</span>, <span class="va">lo</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">hi</span> <span class="op">/</span> <span class="va">lo</span><span class="op">)</span>,</span>
<span>    transform <span class="op">=</span> <span class="va">exp</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term Contrast Estimate Pr(&gt;|z|)    S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  Age     +1          0.962   &lt;0.001 24.9 0.949  0.975</span></span>
<span><span class="co">#&gt;  PClass  2nd, 1st    0.267   &lt;0.001 19.6 0.157  0.456</span></span>
<span><span class="co">#&gt;  PClass  3rd, 1st    0.323   &lt;0.001 35.9 0.233  0.449</span></span>
<span><span class="co">#&gt;  SexCode 1, 0        4.506   &lt;0.001 86.6 3.421  5.934</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, p.value, s.value, conf.low, conf.high</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since the <code>exp</code> function is now passed to the <code>transform</code> argument of the <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> function, the exponentiation is now done only <em>after</em> unit-level contrasts have been averaged. This is what <code>Stata</code> appears to do under the hood, and the results are slightly different.</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    comparison <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">hi</span>, <span class="va">lo</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hi</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lo</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    transform <span class="op">=</span> <span class="va">exp</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term Contrast Estimate Pr(&gt;|z|)     S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  Age     +1          0.986   &lt;0.001  25.5 0.981  0.991</span></span>
<span><span class="co">#&gt;  PClass  2nd, 1st    0.652   &lt;0.001  27.1 0.565  0.754</span></span>
<span><span class="co">#&gt;  PClass  3rd, 1st    0.388   &lt;0.001  53.8 0.311  0.485</span></span>
<span><span class="co">#&gt;  SexCode 1, 0        3.228   &lt;0.001 134.0 2.720  3.831</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that equivalent results can be obtained using shortcut strings in the <code>comparison</code> argument: “ratio”, “lnratio”, “lnratioavg”.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    comparison <span class="op">=</span> <span class="st">"lnratioavg"</span>,</span>
<span>    transform <span class="op">=</span> <span class="va">exp</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term                  Contrast Estimate Pr(&gt;|z|)     S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  Age     mean(+1)                     0.986   &lt;0.001  25.5 0.981  0.991</span></span>
<span><span class="co">#&gt;  PClass  ln(mean(2nd) / mean(1st))    0.652   &lt;0.001  27.1 0.565  0.754</span></span>
<span><span class="co">#&gt;  PClass  ln(mean(3rd) / mean(1st))    0.388   &lt;0.001  53.8 0.311  0.485</span></span>
<span><span class="co">#&gt;  SexCode ln(mean(1) / mean(0))        3.228   &lt;0.001 134.0 2.720  3.831</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="hypothesis" class="level1"><h1>Hypothesis</h1>
<p>Now, let’s see how we can conduct even more specific queries, using hypothesis tests. The <code>marginaleffects</code> website includes <a href="https://marginaleffects.com/vignettes/hypothesis.html">a very detailed vignette on hypothesis tests.</a>. It showcases very complex aggregations, comparisons, and tests. Here, we only introduce simple tests.</p>
<p>Imagine one is interested in this question:</p>
<blockquote class="blockquote">
<p>Does moving from 1st to 3rd class have a bigger effect on the probability of survival for 50 year old men, or for 50 year old women?</p>
</blockquote>
<p>To answer this, we can start by using the <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> and the <code><a href="https://marginaleffects.com/man/datagrid.html">datagrid()</a></code> functions:</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1st"</span>, <span class="st">"3rd"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">50</span>, SexCode <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At first glane, it looks like the estimated contrast is more negative for women (-0.511) than for men (-0.184). But is the difference between then statistical significant? To answer this question, we express the test of equality as a string formula, where <code>b1</code> identifies the estimate in the first row and <code>b2</code> the second row:</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>  hypothesis <span class="op">=</span> <span class="st">"b1 = b2"</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1st"</span>, <span class="st">"3rd"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">50</span>, SexCode <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|)   S  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     0.327      0.135 2.42   0.0156 6.0 0.0618  0.592</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: b1=b2</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The p value is small, which means we can reject the null hypothesis that the effect of moving from 1st to 3rd class on the probability of survival is the same for men and women.</p>
<p>The calculation above is equivalent to:</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cmp</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">cmp</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0.3268809</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also compare all the average contrasts in a call, by specifying <code>hypothesis="pairwise"</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span>, hypothesis <span class="op">=</span> <span class="st">"pairwise"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                                               Term Estimate Std. Error      z Pr(&gt;|z|)     S  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  (Age, mean(+1)) - (PClass, mean(2nd) - mean(1st))                    0.219     0.0403   5.42   &lt;0.001  24.0  0.140  0.298</span></span>
<span><span class="co">#&gt;  (Age, mean(+1)) - (PClass, mean(3rd) - mean(1st))                    0.390     0.0422   9.24   &lt;0.001  65.1  0.307  0.472</span></span>
<span><span class="co">#&gt;  (Age, mean(+1)) - (SexCode, mean(1) - mean(0))                      -0.503     0.0298 -16.87   &lt;0.001 209.7 -0.562 -0.445</span></span>
<span><span class="co">#&gt;  (PClass, mean(2nd) - mean(1st)) - (PClass, mean(3rd) - mean(1st))    0.171     0.0331   5.16   &lt;0.001  21.9  0.106  0.236</span></span>
<span><span class="co">#&gt;  (PClass, mean(2nd) - mean(1st)) - (SexCode, mean(1) - mean(0))      -0.722     0.0438 -16.51   &lt;0.001 200.9 -0.808 -0.636</span></span>
<span><span class="co">#&gt;  (PClass, mean(3rd) - mean(1st)) - (SexCode, mean(1) - mean(0))      -0.893     0.0388 -23.00   &lt;0.001 386.4 -0.969 -0.817</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="visualization" class="level1"><h1>Visualization</h1>
<p>The <code><a href="https://marginaleffects.com/man/plot_comparisons.html">plot_comparisons()</a></code> function can plot comparisons, differences, risk ratios, etc. The <a href="https://marginaleffects.com/vignettes/plot.html">plotting vignette gives detailed insight into the use of this function.</a> Here, it will be sufficient to illustrate its use by a few examples, and to note that most of the arguments of <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> are supported by <code><a href="https://marginaleffects.com/man/plot_comparisons.html">plot_comparisons()</a></code>.</p>
<p>Here, we plot Adjusted Risk Ratio and Adjusted Risk Difference in a model with a quadratic term:</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod_titanic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span></span>
<span>    <span class="va">Survived</span> <span class="op">~</span> <span class="va">Sex</span> <span class="op">*</span> <span class="va">PClass</span> <span class="op">+</span> <span class="va">Age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">Age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>    family <span class="op">=</span> <span class="va">binomial</span>,</span>
<span>    data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://marginaleffects.com/man/plot_comparisons.html">plot_comparisons</a></span><span class="op">(</span></span>
<span>    <span class="va">mod_titanic</span>,</span>
<span>    variables <span class="op">=</span> <span class="st">"Age"</span>,</span>
<span>    condition <span class="op">=</span> <span class="st">"Age"</span>,</span>
<span>    comparison <span class="op">=</span> <span class="st">"ratio"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Adjusted Risk Ratio\nP(Survival | Age + 1) / P(Survival | Age)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://marginaleffects.com/man/plot_comparisons.html">plot_comparisons</a></span><span class="op">(</span></span>
<span>    <span class="va">mod_titanic</span>,</span>
<span>    variables <span class="op">=</span> <span class="st">"Age"</span>,</span>
<span>    condition <span class="op">=</span> <span class="st">"Age"</span>,<span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Adjusted Risk Difference\nP(Survival | Age + 1) - P(Survival | Age)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="comparisons_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<section id="customization" class="level2"><h2 class="anchored" data-anchor-id="customization">Customization</h2>
<p>The <a href="https://marginaleffects.com/vignettes/plot.html#customization">plot customization section of the Plots vignette</a> illustrates two more ways to customize plots. In addition to using the <code>plot_*()</code> function arguments, users can:</p>
<ol type="1">
<li>Modify the plot objects using <code>ggplot2</code> functions or add-on packages.</li>
<li>Extract the underlying plotting data with the <code>draw=FALSE</code> argument, and feed that data to their preferred plotting software.</li>
</ol></section></section><section id="visual-guide" class="level1"><h1>Visual guide</h1>
<p>This section illustrates some of the concepts in this vignette visually.</p>
<p>Consider a model with an interaction term. What happens to the dependent variable when the <code>hp</code> variable increases by 10 units?</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marginaleffects.com/">marginaleffects</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">*</span> <span class="va">wt</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/plot_comparisons.html">plot_comparisons</a></span><span class="op">(</span></span>
<span>    <span class="va">mt</span>,</span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>hp <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    condition <span class="op">=</span> <span class="st">"wt"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="comparisons_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">okabeito</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'#E69F00'</span>, <span class="st">'#56B4E9'</span>, <span class="st">'#009E73'</span>, <span class="st">'#F0E442'</span>, <span class="st">'#0072B2'</span>, <span class="st">'#D55E00'</span>, <span class="st">'#CC79A7'</span>, <span class="st">'#999999'</span>, <span class="st">'#000000'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>ggplot2.discrete.fill <span class="op">=</span> <span class="va">okabeito</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marginaleffects.com/">marginaleffects</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1024</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>  cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  episode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span>, <span class="va">n</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">cond</span> <span class="op">*</span> <span class="va">episode</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://marginaleffects.com/man/predictions.html">predictions</a></span><span class="op">(</span><span class="va">model1</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>cond <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, episode <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cond</span>, y <span class="op">=</span> <span class="va">estimate</span>, shape <span class="op">=</span> <span class="va">episode</span>, color <span class="op">=</span> <span class="va">episode</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="comparisons_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="co"># do episodes 1 and 2 differ when `cond=0`</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cond</span>, y <span class="op">=</span> <span class="va">estimate</span>, shape <span class="op">=</span> <span class="va">episode</span>, color <span class="op">=</span> <span class="va">episode</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, xend <span class="op">=</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"What is the vertical distance between the linked points?"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="comparisons_files/figure-html/unnamed-chunk-47-2.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">model1</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>episode <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="co"># comparison of interest</span></span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>cond <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>    <span class="co"># grid</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  cond Estimate Std. Error     z Pr(&gt;|z|)   S  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     0    0.241      0.396 0.609    0.542 0.9 -0.535   1.02</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: episode</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: 2 - 1</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, cond, predicted_lo, predicted_hi, predicted, episode, y</span></span>
<span></span>
<span><span class="co"># do cond=0 and cond=1 differ when episode = 1</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cond</span>, y <span class="op">=</span> <span class="va">estimate</span>, shape <span class="op">=</span> <span class="va">episode</span>, color <span class="op">=</span> <span class="va">episode</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, xend <span class="op">=</span> <span class="fl">2</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">okabeito</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"What is the vertical distance between the linked points?"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="comparisons_files/figure-html/unnamed-chunk-47-3.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">model1</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"cond"</span>,              <span class="co"># comparison of interest</span></span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>episode <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># grid</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  episode Estimate Std. Error    z Pr(&gt;|z|)   S  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;        1    0.546      0.347 1.57    0.115 3.1 -0.134   1.23</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: cond</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: 1 - 0</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, episode, predicted_lo, predicted_hi, predicted, cond, y</span></span>
<span></span>
<span><span class="co"># Is the difference between episode 1 and 2 larger in cond=0 or cond=1? </span></span>
<span><span class="co"># try this without the `hypothesis` argument to see what we are comparing more clearly</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cond</span>, y <span class="op">=</span> <span class="va">estimate</span>, shape <span class="op">=</span> <span class="va">episode</span>, color <span class="op">=</span> <span class="va">episode</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, xmin <span class="op">=</span> <span class="fl">.9</span>, xmax <span class="op">=</span> <span class="fl">1.1</span>, ymin <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, alpha <span class="op">=</span> <span class="fl">.2</span>, fill <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, xmin <span class="op">=</span> <span class="fl">1.9</span>, xmax <span class="op">=</span> <span class="fl">2.1</span>, ymin <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, alpha <span class="op">=</span> <span class="fl">.2</span>, fill <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Is the green box taller than the orange box?"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="comparisons_files/figure-html/unnamed-chunk-47-4.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">model1</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>episode <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="co"># comparison of interest</span></span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>cond <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>,  <span class="co"># grid</span></span>
<span>  hypothesis <span class="op">=</span> <span class="st">"b1 = b2"</span><span class="op">)</span>          <span class="co"># hypothesis</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)   S  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     0.413      0.508 0.812    0.417 1.3 -0.583   1.41</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: b1=b2</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="more" class="level1"><h1>More</h1>
<section id="manual-computation" class="level2"><h2 class="anchored" data-anchor-id="manual-computation">Manual computation</h2>
<p>Now we show how to use the base <code>R</code> <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function to compute some of the same quantities as above. This exercise may be clarifying for some users.</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">grid_50_1_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">50</span>, SexCode <span class="op">=</span> <span class="fl">1</span>, PClass <span class="op">=</span> <span class="st">"3rd"</span><span class="op">)</span></span>
<span><span class="va">grid_50_1_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">50</span>, SexCode <span class="op">=</span> <span class="fl">1</span>, PClass <span class="op">=</span> <span class="st">"1st"</span><span class="op">)</span></span>
<span><span class="va">grid_50_0_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">50</span>, SexCode <span class="op">=</span> <span class="fl">0</span>, PClass <span class="op">=</span> <span class="st">"3rd"</span><span class="op">)</span></span>
<span><span class="va">grid_50_0_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">50</span>, SexCode <span class="op">=</span> <span class="fl">0</span>, PClass <span class="op">=</span> <span class="st">"1st"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">yhat_50_1_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">grid_50_1_3</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">yhat_50_1_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">grid_50_1_1</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">yhat_50_0_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">grid_50_0_3</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">yhat_50_0_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">grid_50_0_1</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## prediction on a grid</span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">50</span>, SexCode <span class="op">=</span> <span class="fl">1</span>, PClass <span class="op">=</span> <span class="st">"3rd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Age SexCode PClass Estimate Pr(&gt;|z|)   S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;   50       1    3rd    0.446    0.661 0.6 0.235  0.679</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  invlink(link) </span></span>
<span><span class="co">#&gt; Columns: rowid, estimate, p.value, s.value, conf.low, conf.high, Age, SexCode, PClass, Survived</span></span>
<span><span class="va">yhat_50_1_3</span></span>
<span><span class="co">#&gt;         1 </span></span>
<span><span class="co">#&gt; 0.4463379</span></span>
<span></span>
<span><span class="co">## contrast on a grid</span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1st"</span>, <span class="st">"3rd"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">50</span>, SexCode <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Age SexCode Estimate Std. Error     z Pr(&gt;|z|)    S  2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;   50       0   -0.184     0.0535 -3.45   &lt;0.001 10.8 -0.289 -0.0796</span></span>
<span><span class="co">#&gt;   50       1   -0.511     0.1242 -4.12   &lt;0.001 14.7 -0.755 -0.2679</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: PClass</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: 3rd - 1st</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, Age, SexCode, predicted_lo, predicted_hi, predicted, PClass, Survived</span></span>
<span></span>
<span><span class="va">yhat_50_0_3</span> <span class="op">-</span> <span class="va">yhat_50_0_1</span></span>
<span><span class="co">#&gt;          1 </span></span>
<span><span class="co">#&gt; -0.1844289</span></span>
<span><span class="va">yhat_50_1_3</span> <span class="op">-</span> <span class="va">yhat_50_1_1</span></span>
<span><span class="co">#&gt;          1 </span></span>
<span><span class="co">#&gt; -0.5113098</span></span>
<span></span>
<span><span class="co">## difference-in-differences </span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1st"</span>, <span class="st">"3rd"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">50</span>, SexCode <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  hypothesis <span class="op">=</span> <span class="st">"b1 = b2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|)   S  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     0.327      0.135 2.42   0.0156 6.0 0.0618  0.592</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: b1=b2</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high</span></span>
<span></span>
<span><span class="op">(</span><span class="va">yhat_50_0_3</span> <span class="op">-</span> <span class="va">yhat_50_0_1</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">yhat_50_1_3</span> <span class="op">-</span> <span class="va">yhat_50_1_1</span><span class="op">)</span></span>
<span><span class="co">#&gt;         1 </span></span>
<span><span class="co">#&gt; 0.3268809</span></span>
<span></span>
<span><span class="co">## average of the empirical distribution of contrasts</span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1st"</span>, <span class="st">"3rd"</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"SexCode"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  SexCode Estimate Std. Error     z Pr(&gt;|z|)    S  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;        0   -0.334     0.0570 -5.86   &lt;0.001 27.7 -0.446 -0.222</span></span>
<span><span class="co">#&gt;        1   -0.496     0.0623 -7.95   &lt;0.001 49.0 -0.618 -0.374</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: PClass</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: mean(3rd) - mean(1st)</span></span>
<span><span class="co">#&gt; Columns: term, contrast, SexCode, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span>
<span></span>
<span><span class="va">grid_empirical_1_3</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">SexCode</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="st">"3rd"</span><span class="op">)</span></span>
<span><span class="va">grid_empirical_1_1</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">SexCode</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="st">"1st"</span><span class="op">)</span></span>
<span><span class="va">grid_empirical_0_3</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">SexCode</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="st">"3rd"</span><span class="op">)</span></span>
<span><span class="va">grid_empirical_0_1</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">SexCode</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="st">"1st"</span><span class="op">)</span></span>
<span><span class="va">yhat_empirical_0_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">grid_empirical_0_1</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">yhat_empirical_0_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">grid_empirical_0_3</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">yhat_empirical_1_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">grid_empirical_1_1</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">yhat_empirical_1_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">grid_empirical_1_3</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">yhat_empirical_0_3</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">yhat_empirical_0_1</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.3341426</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">yhat_empirical_1_3</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">yhat_empirical_1_1</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.4956673</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="transformations" class="level2"><h2 class="anchored" data-anchor-id="transformations">Transformations</h2>
<p>So far we have focused on simple differences between adjusted predictions. Now, we show how to use ratios, back transformations, and arbitrary functions to estimate a slew of quantities of interest. Powerful transformations and custom contrasts are made possible by using three arguments which act at different stages of the computation process:</p>
<ul>
<li><code>comparison</code></li>
<li><code>transform</code></li>
</ul>
<p>Consider the case of a model with a single predictor <span class="math inline">\(x\)</span>. To compute average contrasts, we proceed as follows:</p>
<ol type="1">
<li>Compute adjusted predictions for each row of the dataset for the observed values <span class="math inline">\(x\)</span>: <span class="math inline">\(\hat{y}_x\)</span>
</li>
<li>Compute adjusted predictions for each row of the dataset for the observed values <span class="math inline">\(x + 1\)</span>: <span class="math inline">\(\hat{y}_{x+1}\)</span>
</li>
<li>
<code>comparison</code>: Compute unit-level contrasts by taking the difference between (or some other function of) adjusted predictions: <span class="math inline">\(\hat{y}_{x+1} - \hat{y}_x\)</span>
</li>
<li>Compute the average contrast by taking the mean of unit-level contrasts: <span class="math inline">\(1/N \sum_{i=1}^N \hat{y}_{x+1} - \hat{y}_x\)</span>
</li>
<li>
<code>transform</code>: Transform the average contrast or return them as-is.</li>
</ol>
<p>The <code>comparison</code> argument of the <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> function determines how adjusted predictions are combined to create a contrast. By default, we take a simple difference between predictions with <code>hi</code> value of <span class="math inline">\(x\)</span>, and predictions with a <code>lo</code> value of <span class="math inline">\(x\)</span>: <code>function(hi, lo) hi-lo</code>.</p>
<p>The <code>transform</code> argument of the <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> function applies a custom transformation to the unit-level contrasts.</p>
<p>The <code>transform</code> argument applies a custom transformation to the final quantity, as would be returned if we evaluated the same call without <code>transform</code>.</p>
<p>This call adds the <code>transform</code> argument to exponentiate the log-odds ratios at the very end of calculations:</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Survived</span> <span class="op">~</span> <span class="va">PClass</span> <span class="op">*</span> <span class="va">SexCode</span> <span class="op">*</span> <span class="va">Age</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, </span>
<span>    comparison <span class="op">=</span> <span class="st">"lnor"</span>, </span>
<span>    transform <span class="op">=</span> <span class="va">exp</span>,</span>
<span>    newdata <span class="op">=</span> <span class="va">passenger</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term                  Contrast Estimate Pr(&gt;|z|)    S  2.5 % 97.5 % PClass Age SexCode</span></span>
<span><span class="co">#&gt;  Age     +1                           0.951   0.0121  6.4 0.9137  0.989    3rd  20       0</span></span>
<span><span class="co">#&gt;  PClass  ln(odds(2nd) / odds(1st))    0.208   &lt;0.001 11.0 0.0864  0.502    3rd  20       0</span></span>
<span><span class="co">#&gt;  PClass  ln(odds(3rd) / odds(1st))    0.144   &lt;0.001 19.8 0.0660  0.314    3rd  20       0</span></span>
<span><span class="co">#&gt;  SexCode ln(odds(1) / odds(0))        3.755   &lt;0.001 17.8 2.1345  6.607    3rd  20       0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, PClass, Age, SexCode, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="difference-in-differences" class="level2"><h2 class="anchored" data-anchor-id="difference-in-differences">Difference-in-Differences</h2>
<p>One thing we can notice in the Titanic example, is that the gap in predicted probabilities of survival between men and women is larger in 1st class than in 3rd class.</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span></span>
<span>  <span class="va">mod</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"SexCode"</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1st"</span>, <span class="st">"3rd"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  PClass Estimate Std. Error    z Pr(&gt;|z|)    S 2.5 % 97.5 %  Age</span></span>
<span><span class="co">#&gt;     1st    0.483     0.0631 7.65   &lt;0.001 45.5 0.359  0.606 30.4</span></span>
<span><span class="co">#&gt;     3rd    0.335     0.0634 5.29   &lt;0.001 22.9 0.211  0.459 30.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: SexCode</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: 1 - 0</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, PClass, predicted_lo, predicted_hi, predicted, SexCode, Age, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Indeed, being a woman matters more for your chances of survival if you travel in first class. Is the difference between those contrasts (diff-in-diff) statistically significant?</p>
<p>To answer this question, we can compute a difference-in-difference using the <code>hypothesis</code> argument (<a href="hypothesis.html">see the Hypothesis vignette for details</a>). For example, using <code>b1</code> and <code>b2</code> to refer to the contrasts in the first and second rows of the output above, we can test if the difference between the two quantities is different from 0:</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span></span>
<span>  <span class="va">mod</span>,</span>
<span>  hypothesis <span class="op">=</span> <span class="st">"b1 - b2 = 0"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"SexCode"</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1st"</span>, <span class="st">"3rd"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|)   S   2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     0.148     0.0894 1.65   0.0987 3.3 -0.0276  0.323</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: b1-b2=0</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s say we consider more types of individuals:</p>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span></span>
<span>  <span class="va">mod</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"SexCode"</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1st"</span>, <span class="st">"3rd"</span><span class="op">)</span>, Age <span class="op">=</span> <span class="va">range</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  PClass   Age Estimate Std. Error      z Pr(&gt;|z|)     S   2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     1st  0.17   0.1081      0.122  0.883   0.3774   1.4 -0.1319  0.348</span></span>
<span><span class="co">#&gt;     1st 71.00   0.8795      0.057 15.437   &lt;0.001 176.2  0.7679  0.991</span></span>
<span><span class="co">#&gt;     3rd  0.17   0.0805      0.157  0.513   0.6081   0.7 -0.2272  0.388</span></span>
<span><span class="co">#&gt;     3rd 71.00   0.4265      0.203  2.101   0.0356   4.8  0.0287  0.824</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: SexCode</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: 1 - 0</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, PClass, Age, predicted_lo, predicted_hi, predicted, SexCode, Survived</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With these results, we could compute a triple difference:</p>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">comparisons</a></span><span class="op">(</span></span>
<span>  <span class="va">mod</span>,</span>
<span>  hypothesis <span class="op">=</span> <span class="st">"(b1 - b3) - (b2 - b4) = 0"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"SexCode"</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/datagrid.html">datagrid</a></span><span class="op">(</span>PClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1st"</span>, <span class="st">"3rd"</span><span class="op">)</span>, Age <span class="op">=</span> <span class="va">range</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)   S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;    -0.425      0.359 -1.19    0.236 2.1 -1.13  0.278</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: (b1-b3)-(b2-b4)=0</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="forward-backward-centered" class="level2"><h2 class="anchored" data-anchor-id="forward-backward-centered">Forward, Backward, Centered</h2>
<p>By default, the <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> function computes a “forward” difference. For example, if we ask <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> to estimate the effect of a 10-unit change in predictor <code>x</code> on outcome <code>y</code>, <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> will compare the predicted values with <code>x</code> and <code>x+10</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mt</span> <span class="op">&lt;-</span> <span class="va">mtcars</span></span>
<span><span class="va">mt</span><span class="op">$</span><span class="va">new_hp</span> <span class="op">&lt;-</span> <span class="fl">49</span> <span class="op">*</span> <span class="op">(</span><span class="va">mt</span><span class="op">$</span><span class="va">hp</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">mt</span><span class="op">$</span><span class="va">hp</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">mt</span><span class="op">$</span><span class="va">hp</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">mt</span><span class="op">$</span><span class="va">hp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="va">mod_mt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">new_hp</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mt</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span></span>
<span>  <span class="va">mod_mt</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>new_hp <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)    S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;      -3.8      0.435 -8.74   &lt;0.001 58.6 -4.65  -2.95</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: new_hp</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: mean(+10)</span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can supply arbitrary functions to create custom differences. These functions must accept a vector of values for the predictor of interest, and return a data frame with the same number of rows as the length, and two columns with the values to compare. For example, we can do:</p>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">forward_diff</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">x</span> <span class="op">+</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">backward_diff</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fl">10</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="va">center_diff</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fl">5</span>, <span class="va">x</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span></span>
<span>  <span class="va">mod_mt</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>new_hp <span class="op">=</span> <span class="va">forward_diff</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)    S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;      -3.8      0.435 -8.74   &lt;0.001 58.6 -4.65  -2.95</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: new_hp</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: custom</span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span></span>
<span>  <span class="va">mod_mt</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>new_hp <span class="op">=</span> <span class="va">backward_diff</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)    S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     -6.51      0.744 -8.74   &lt;0.001 58.6 -7.97  -5.05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: new_hp</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: custom</span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span></span>
<span>  <span class="va">mod_mt</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>new_hp <span class="op">=</span> <span class="va">center_diff</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error     z Pr(&gt;|z|)    S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     -4.06      0.464 -8.74   &lt;0.001 58.6 -4.97  -3.15</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: new_hp</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Comparison: custom</span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that the last “centered” difference gives the same results as the default <code><a href="https://marginaleffects.com/man/comparisons.html">comparisons()</a></code> call.</p>
</section><section id="observation-wise-categorical-marginal-effect" class="level2"><h2 class="anchored" data-anchor-id="observation-wise-categorical-marginal-effect">Observation-Wise Categorical Marginal Effect</h2>
<p>For categorical predictors, <a href="https://arxiv.org/pdf/2201.08837.pdf">Scholbeck et al.&nbsp;2023</a> recommend that analysts report what they call the “observation-wise categorical marginal effects.” They describe the procedure as follows:</p>
<blockquote class="blockquote">
<p>Recall that the common definition of categorical MEs is based on first changing all observations’ value of <span class="math inline">\(x_j\)</span> to each category and then computing the difference in predictions when changing it to the reference category. However, one is often interested in prediction changes if aspects of an actual observation change. We therefore propose an observation-wise categorical ME. We first select a single reference category <span class="math inline">\(c_h\)</span>. For each observation whose feature value <span class="math inline">\(x_j \neq c_h\)</span>, we predict once with the observed value <span class="math inline">\(x_j\)</span> and once where <span class="math inline">\(x_j\)</span> has been replaced by <span class="math inline">\(c_h\)</span>.</p>
</blockquote>
<p>To achieve this with <code>marginaleffects</code>, we proceed in three simple steps:</p>
<ol type="1">
<li>Use the <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> function to set the reference level of the categorical variable.</li>
<li>Use the <code>newdata</code> argument to take the subset of data where the observed <span class="math inline">\(x_j\)</span> is different from the reference level we picked in 1.</li>
<li>Apply the <code><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons()</a></code> with the <code>"revreference"</code> option.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span><span class="va">mtcars</span>, cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cyl</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod_mt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">mpg</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mt</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod_mt</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="st">"revreference"</span><span class="op">)</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">mt</span>, <span class="va">cyl</span> <span class="op">!=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           Contrast Estimate Std. Error     z Pr(&gt;|z|)     S  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  mean(6) - mean(4)   -0.323     0.2170 -1.49    0.137   2.9 -0.748  0.103</span></span>
<span><span class="co">#&gt;  mean(6) - mean(8)    0.561     0.0357 15.69   &lt;0.001 181.9  0.491  0.631</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Term: cyl</span></span>
<span><span class="co">#&gt; Type:  response </span></span>
<span><span class="co">#&gt; Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../vignettes/predictions.html" class="pagination-link" aria-label="Predictions">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Predictions</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../vignettes/slopes.html" class="pagination-link" aria-label="Slopes">
        <span class="nav-page-text">Slopes</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>